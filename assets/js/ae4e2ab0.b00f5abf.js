"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[70613],{3905:(e,t,n)=>{n.d(t,{Zo:()=>l,kt:()=>d});var o=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},c=Object.keys(e);for(o=0;o<c.length;o++)n=c[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(o=0;o<c.length;o++)n=c[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var i=o.createContext({}),p=function(e){var t=o.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},l=function(e){var t=p(e.components);return o.createElement(i.Provider,{value:t},e.children)},u="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},m=o.forwardRef((function(e,t){var n=e.components,r=e.mdxType,c=e.originalType,i=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),u=p(n),m=r,d=u["".concat(i,".").concat(m)]||u[m]||h[m]||c;return n?o.createElement(d,a(a({ref:t},l),{},{components:n})):o.createElement(d,a({ref:t},l))}));function d(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var c=n.length,a=new Array(c);a[0]=m;var s={};for(var i in t)hasOwnProperty.call(t,i)&&(s[i]=t[i]);s.originalType=e,s[u]="string"==typeof e?e:r,a[1]=s;for(var p=2;p<c;p++)a[p]=n[p];return o.createElement.apply(null,a)}return o.createElement.apply(null,n)}m.displayName="MDXCreateElement"},15566:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>i,contentTitle:()=>a,default:()=>d,frontMatter:()=>c,metadata:()=>s,toc:()=>p});var o=n(87462),r=(n(67294),n(3905));const c={},a="Custom functions with OpenAI Functions Agent",s={unversionedId:"modules/agents/how_to/custom-functions-with-openai-functions-agent",id:"modules/agents/how_to/custom-functions-with-openai-functions-agent",title:"Custom functions with OpenAI Functions Agent",description:"This notebook goes through how to integrate custom functions with OpenAI Functions agent.",source:"@site/docs/modules/agents/how_to/custom-functions-with-openai-functions-agent.md",sourceDirName:"modules/agents/how_to",slug:"/modules/agents/how_to/custom-functions-with-openai-functions-agent",permalink:"/langchain/docs/modules/agents/how_to/custom-functions-with-openai-functions-agent",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"docs",previous:{title:"Create ChatGPT clone",permalink:"/langchain/docs/modules/agents/how_to/chatgpt_clone"},next:{title:"Custom agent",permalink:"/langchain/docs/modules/agents/how_to/custom_agent"}},i={},p=[{value:"Define custom functions",id:"define-custom-functions",level:2},{value:"Make custom tools",id:"make-custom-tools",level:2},{value:"Create Agent",id:"create-agent",level:2}],l=(u="CodeOutputBlock",function(e){return console.warn("Component "+u+" was not imported, exported, or provided by MDXProvider as global scope"),(0,r.kt)("div",e)});var u;const h={toc:p},m="wrapper";function d(e){let{components:t,...n}=e;return(0,r.kt)(m,(0,o.Z)({},h,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"custom-functions-with-openai-functions-agent"},"Custom functions with OpenAI Functions Agent"),(0,r.kt)("p",null,"This notebook goes through how to integrate custom functions with OpenAI Functions agent."),(0,r.kt)("p",null,"Install libraries which are required to run this example notebook:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"pip install -q openai langchain yfinance\n")),(0,r.kt)("h2",{id:"define-custom-functions"},"Define custom functions"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'import yfinance as yf\nfrom datetime import datetime, timedelta\n\n\ndef get_current_stock_price(ticker):\n    """Method to get current stock price"""\n\n    ticker_data = yf.Ticker(ticker)\n    recent = ticker_data.history(period="1d")\n    return {"price": recent.iloc[0]["Close"], "currency": ticker_data.info["currency"]}\n\n\ndef get_stock_performance(ticker, days):\n    """Method to get stock price change in percentage"""\n\n    past_date = datetime.today() - timedelta(days=days)\n    ticker_data = yf.Ticker(ticker)\n    history = ticker_data.history(start=past_date)\n    old_price = history.iloc[0]["Close"]\n    current_price = history.iloc[-1]["Close"]\n    return {"percent_change": ((current_price - old_price) / old_price) * 100}\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'get_current_stock_price("MSFT")\n')),(0,r.kt)(l,{lang:"python",mdxType:"CodeOutputBlock"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"    {'price': 334.57000732421875, 'currency': 'USD'}\n"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'get_stock_performance("MSFT", 30)\n')),(0,r.kt)(l,{lang:"python",mdxType:"CodeOutputBlock"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"    {'percent_change': 1.014466941163018}\n"))),(0,r.kt)("h2",{id:"make-custom-tools"},"Make custom tools"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'\x3c!--IMPORTS:[{"imported": "BaseTool", "source": "langchain.tools", "docs": "https://api.python.langchain.com/en/latest/tools/langchain.tools.base.BaseTool.html", "title": "Custom functions with OpenAI Functions Agent"}]--\x3e\nfrom typing import Type\nfrom pydantic import BaseModel, Field\nfrom langchain.tools import BaseTool\n\n\nclass CurrentStockPriceInput(BaseModel):\n    """Inputs for get_current_stock_price"""\n\n    ticker: str = Field(description="Ticker symbol of the stock")\n\n\nclass CurrentStockPriceTool(BaseTool):\n    name = "get_current_stock_price"\n    description = """\n        Useful when you want to get current stock price.\n        You should enter the stock ticker symbol recognized by the yahoo finance\n        """\n    args_schema: Type[BaseModel] = CurrentStockPriceInput\n\n    def _run(self, ticker: str):\n        price_response = get_current_stock_price(ticker)\n        return price_response\n\n    def _arun(self, ticker: str):\n        raise NotImplementedError("get_current_stock_price does not support async")\n\n\nclass StockPercentChangeInput(BaseModel):\n    """Inputs for get_stock_performance"""\n\n    ticker: str = Field(description="Ticker symbol of the stock")\n    days: int = Field(description="Timedelta days to get past date from current date")\n\n\nclass StockPerformanceTool(BaseTool):\n    name = "get_stock_performance"\n    description = """\n        Useful when you want to check performance of the stock.\n        You should enter the stock ticker symbol recognized by the yahoo finance.\n        You should enter days as number of days from today from which performance needs to be check.\n        output will be the change in the stock price represented as a percentage.\n        """\n    args_schema: Type[BaseModel] = StockPercentChangeInput\n\n    def _run(self, ticker: str, days: int):\n        response = get_stock_performance(ticker, days)\n        return response\n\n    def _arun(self, ticker: str):\n        raise NotImplementedError("get_stock_performance does not support async")\n')),(0,r.kt)("h2",{id:"create-agent"},"Create Agent"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'\x3c!--IMPORTS:[{"imported": "AgentType", "source": "langchain.agents", "docs": "https://api.python.langchain.com/en/latest/agents/langchain.agents.agent_types.AgentType.html", "title": "Custom functions with OpenAI Functions Agent"}, {"imported": "ChatOpenAI", "source": "langchain.chat_models", "docs": "https://api.python.langchain.com/en/latest/chat_models/langchain.chat_models.openai.ChatOpenAI.html", "title": "Custom functions with OpenAI Functions Agent"}, {"imported": "initialize_agent", "source": "langchain.agents", "docs": "https://api.python.langchain.com/en/latest/agents/langchain.agents.initialize.initialize_agent.html", "title": "Custom functions with OpenAI Functions Agent"}]--\x3e\nfrom langchain.agents import AgentType\nfrom langchain.chat_models import ChatOpenAI\nfrom langchain.agents import initialize_agent\n\nllm = ChatOpenAI(model="gpt-3.5-turbo-0613", temperature=0)\n\ntools = [CurrentStockPriceTool(), StockPerformanceTool()]\n\nagent = initialize_agent(tools, llm, agent=AgentType.OPENAI_FUNCTIONS, verbose=True)\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'agent.run(\n    "What is the current price of Microsoft stock? How it has performed over past 6 months?"\n)\n')),(0,r.kt)(l,{lang:"python",mdxType:"CodeOutputBlock"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"    \n    \n    > Entering new  chain...\n    \n    Invoking: `get_current_stock_price` with `{'ticker': 'MSFT'}`\n    \n    \n    {'price': 334.57000732421875, 'currency': 'USD'}\n    Invoking: `get_stock_performance` with `{'ticker': 'MSFT', 'days': 180}`\n    \n    \n    {'percent_change': 40.163963297187905}The current price of Microsoft stock is $334.57 USD. \n    \n    Over the past 6 months, Microsoft stock has performed well with a 40.16% increase in its price.\n    \n    > Finished chain.\n\n\n\n\n\n    'The current price of Microsoft stock is $334.57 USD. \\n\\nOver the past 6 months, Microsoft stock has performed well with a 40.16% increase in its price.'\n"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'agent.run("Give me recent stock prices of Google and Meta?")\n')),(0,r.kt)(l,{lang:"python",mdxType:"CodeOutputBlock"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"    \n    \n    > Entering new  chain...\n    \n    Invoking: `get_current_stock_price` with `{'ticker': 'GOOGL'}`\n    \n    \n    {'price': 118.33000183105469, 'currency': 'USD'}\n    Invoking: `get_current_stock_price` with `{'ticker': 'META'}`\n    \n    \n    {'price': 287.04998779296875, 'currency': 'USD'}The recent stock price of Google (GOOGL) is $118.33 USD and the recent stock price of Meta (META) is $287.05 USD.\n    \n    > Finished chain.\n\n\n\n\n\n    'The recent stock price of Google (GOOGL) is $118.33 USD and the recent stock price of Meta (META) is $287.05 USD.'\n"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'agent.run(\n    "In the past 3 months, which stock between Microsoft and Google has performed the best?"\n)\n')),(0,r.kt)(l,{lang:"python",mdxType:"CodeOutputBlock"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"    \n    \n    > Entering new  chain...\n    \n    Invoking: `get_stock_performance` with `{'ticker': 'MSFT', 'days': 90}`\n    \n    \n    {'percent_change': 18.043096235165596}\n    Invoking: `get_stock_performance` with `{'ticker': 'GOOGL', 'days': 90}`\n    \n    \n    {'percent_change': 17.286155760642853}In the past 3 months, Microsoft (MSFT) has performed better than Google (GOOGL). Microsoft's stock price has increased by 18.04% while Google's stock price has increased by 17.29%.\n    \n    > Finished chain.\n\n\n\n\n\n    \"In the past 3 months, Microsoft (MSFT) has performed better than Google (GOOGL). Microsoft's stock price has increased by 18.04% while Google's stock price has increased by 17.29%.\"\n"))))}d.isMDXComponent=!0}}]);