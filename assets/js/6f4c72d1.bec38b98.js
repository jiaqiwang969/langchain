"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[73794],{3905:(e,t,n)=>{n.d(t,{Zo:()=>l,kt:()=>g});var a=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var c=a.createContext({}),m=function(e){var t=a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},l=function(e){var t=m(e.components);return a.createElement(c.Provider,{value:t},e.children)},p="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,c=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),p=m(n),d=o,g=p["".concat(c,".").concat(d)]||p[d]||u[d]||r;return n?a.createElement(g,i(i({ref:t},l),{},{components:n})):a.createElement(g,i({ref:t},l))}));function g(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=d;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s[p]="string"==typeof e?e:o,i[1]=s;for(var m=2;m<r;m++)i[m]=n[m];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},78725:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>g,frontMatter:()=>r,metadata:()=>s,toc:()=>m});var a=n(87462),o=(n(67294),n(3905));const r={},i="OpenAI Functions Metadata Tagger",s={unversionedId:"integrations/document_transformers/openai_metadata_tagger",id:"integrations/document_transformers/openai_metadata_tagger",title:"OpenAI Functions Metadata Tagger",description:"It can often be useful to tag ingested documents with structured metadata, such as the title, tone, or length of a document, to allow for more targeted similarity search later. However, for large numbers of documents, performing this labelling process manually can be tedious.",source:"@site/docs/integrations/document_transformers/openai_metadata_tagger.md",sourceDirName:"integrations/document_transformers",slug:"/integrations/document_transformers/openai_metadata_tagger",permalink:"/langchain/docs/integrations/document_transformers/openai_metadata_tagger",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"integrations",previous:{title:"Nuclia Understanding API document transformer",permalink:"/langchain/docs/integrations/document_transformers/nuclia_transformer"},next:{title:"LLMs",permalink:"/langchain/docs/integrations/llms/"}},c={},m=[{value:"Customization",id:"customization",level:2}],l=(p="CodeOutputBlock",function(e){return console.warn("Component "+p+" was not imported, exported, or provided by MDXProvider as global scope"),(0,o.kt)("div",e)});var p;const u={toc:m},d="wrapper";function g(e){let{components:t,...n}=e;return(0,o.kt)(d,(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"openai-functions-metadata-tagger"},"OpenAI Functions Metadata Tagger"),(0,o.kt)("p",null,"It can often be useful to tag ingested documents with structured metadata, such as the title, tone, or length of a document, to allow for more targeted similarity search later. However, for large numbers of documents, performing this labelling process manually can be tedious."),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"OpenAIMetadataTagger")," document transformer automates this process by extracting metadata from each provided document according to a provided schema. It uses a configurable OpenAI Functions-powered chain under the hood, so if you pass a custom LLM instance, it must be an OpenAI model with functions support. "),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Note:")," This document transformer works best with complete documents, so it's best to run it first with whole documents before doing any other splitting or processing!"),(0,o.kt)("p",null,"For example, let's say you wanted to index a set of movie reviews. You could initialize the document transformer with a valid JSON Schema object as follows:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'\x3c!--IMPORTS:[{"imported": "Document", "source": "langchain.schema", "docs": "https://api.python.langchain.com/en/latest/schema/langchain.schema.document.Document.html", "title": "OpenAI Functions Metadata Tagger"}, {"imported": "ChatOpenAI", "source": "langchain.chat_models", "docs": "https://api.python.langchain.com/en/latest/chat_models/langchain.chat_models.openai.ChatOpenAI.html", "title": "OpenAI Functions Metadata Tagger"}, {"imported": "create_metadata_tagger", "source": "langchain.document_transformers.openai_functions", "docs": "https://api.python.langchain.com/en/latest/document_transformers/langchain.document_transformers.openai_functions.create_metadata_tagger.html", "title": "OpenAI Functions Metadata Tagger"}]--\x3e\nfrom langchain.schema import Document\nfrom langchain.chat_models import ChatOpenAI\nfrom langchain.document_transformers.openai_functions import create_metadata_tagger\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'schema = {\n    "properties": {\n        "movie_title": {"type": "string"},\n        "critic": {"type": "string"},\n        "tone": {"type": "string", "enum": ["positive", "negative"]},\n        "rating": {\n            "type": "integer",\n            "description": "The number of stars the critic rated the movie",\n        },\n    },\n    "required": ["movie_title", "critic", "tone"],\n}\n\n# Must be an OpenAI model that supports functions\nllm = ChatOpenAI(temperature=0, model="gpt-3.5-turbo-0613")\n\ndocument_transformer = create_metadata_tagger(metadata_schema=schema, llm=llm)\n')),(0,o.kt)("p",null,"You can then simply pass the document transformer a list of documents, and it will extract metadata from the contents:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'original_documents = [\n    Document(\n        page_content="Review of The Bee Movie\\nBy Roger Ebert\\n\\nThis is the greatest movie ever made. 4 out of 5 stars."\n    ),\n    Document(\n        page_content="Review of The Godfather\\nBy Anonymous\\n\\nThis movie was super boring. 1 out of 5 stars.",\n        metadata={"reliable": False},\n    ),\n]\n\nenhanced_documents = document_transformer.transform_documents(original_documents)\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'import json\n\nprint(\n    *[d.page_content + "\\n\\n" + json.dumps(d.metadata) for d in enhanced_documents],\n    sep="\\n\\n---------------\\n\\n"\n)\n')),(0,o.kt)(l,{lang:"python",mdxType:"CodeOutputBlock"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'    Review of The Bee Movie\n    By Roger Ebert\n    \n    This is the greatest movie ever made. 4 out of 5 stars.\n    \n    {"movie_title": "The Bee Movie", "critic": "Roger Ebert", "tone": "positive", "rating": 4}\n    \n    ---------------\n    \n    Review of The Godfather\n    By Anonymous\n    \n    This movie was super boring. 1 out of 5 stars.\n    \n    {"movie_title": "The Godfather", "critic": "Anonymous", "tone": "negative", "rating": 1, "reliable": false}\n'))),(0,o.kt)("p",null,"The new documents can then be further processed by a text splitter before being loaded into a vector store. Extracted fields will not overwrite existing metadata."),(0,o.kt)("p",null,"You can also initialize the document transformer with a Pydantic schema:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'from typing import Literal\n\nfrom pydantic import BaseModel, Field\n\n\nclass Properties(BaseModel):\n    movie_title: str\n    critic: str\n    tone: Literal["positive", "negative"]\n    rating: int = Field(description="Rating out of 5 stars")\n\n\ndocument_transformer = create_metadata_tagger(Properties, llm)\nenhanced_documents = document_transformer.transform_documents(original_documents)\n\nprint(\n    *[d.page_content + "\\n\\n" + json.dumps(d.metadata) for d in enhanced_documents],\n    sep="\\n\\n---------------\\n\\n"\n)\n')),(0,o.kt)(l,{lang:"python",mdxType:"CodeOutputBlock"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'    Review of The Bee Movie\n    By Roger Ebert\n    \n    This is the greatest movie ever made. 4 out of 5 stars.\n    \n    {"movie_title": "The Bee Movie", "critic": "Roger Ebert", "tone": "positive", "rating": 4}\n    \n    ---------------\n    \n    Review of The Godfather\n    By Anonymous\n    \n    This movie was super boring. 1 out of 5 stars.\n    \n    {"movie_title": "The Godfather", "critic": "Anonymous", "tone": "negative", "rating": 1, "reliable": false}\n'))),(0,o.kt)("h2",{id:"customization"},"Customization"),(0,o.kt)("p",null,"You can pass the underlying tagging chain the standard LLMChain arguments in the document transformer constructor. For example, if you wanted to ask the LLM to focus specific details in the input documents, or extract metadata in a certain style, you could pass in a custom prompt:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'\x3c!--IMPORTS:[{"imported": "ChatPromptTemplate", "source": "langchain.prompts", "docs": "https://api.python.langchain.com/en/latest/prompts/langchain.prompts.chat.ChatPromptTemplate.html", "title": "OpenAI Functions Metadata Tagger"}]--\x3e\nfrom langchain.prompts import ChatPromptTemplate\n\nprompt = ChatPromptTemplate.from_template(\n    """Extract relevant information from the following text.\nAnonymous critics are actually Roger Ebert.\n\n{input}\n"""\n)\n\ndocument_transformer = create_metadata_tagger(schema, llm, prompt=prompt)\nenhanced_documents = document_transformer.transform_documents(original_documents)\n\nprint(\n    *[d.page_content + "\\n\\n" + json.dumps(d.metadata) for d in enhanced_documents],\n    sep="\\n\\n---------------\\n\\n"\n)\n')),(0,o.kt)(l,{lang:"python",mdxType:"CodeOutputBlock"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'    Review of The Bee Movie\n    By Roger Ebert\n    \n    This is the greatest movie ever made. 4 out of 5 stars.\n    \n    {"movie_title": "The Bee Movie", "critic": "Roger Ebert", "tone": "positive", "rating": 4}\n    \n    ---------------\n    \n    Review of The Godfather\n    By Anonymous\n    \n    This movie was super boring. 1 out of 5 stars.\n    \n    {"movie_title": "The Godfather", "critic": "Roger Ebert", "tone": "negative", "rating": 1, "reliable": false}\n'))))}g.isMDXComponent=!0}}]);