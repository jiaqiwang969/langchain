"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[33256],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>g});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},u="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,l=e.originalType,s=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),u=p(n),d=r,g=u["".concat(s,".").concat(d)]||u[d]||m[d]||l;return n?a.createElement(g,o(o({ref:t},c),{},{components:n})):a.createElement(g,o({ref:t},c))}));function g(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=n.length,o=new Array(l);o[0]=d;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i[u]="string"==typeof e?e:r,o[1]=i;for(var p=2;p<l;p++)o[p]=n[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},10291:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>m,frontMatter:()=>l,metadata:()=>i,toc:()=>p});var a=n(87462),r=(n(67294),n(3905));const l={},o="Flyte",i={unversionedId:"integrations/providers/flyte",id:"integrations/providers/flyte",title:"Flyte",description:"Flyte is an open-source orchestrator that facilitates building production-grade data and ML pipelines.",source:"@site/docs/integrations/providers/flyte.mdx",sourceDirName:"integrations/providers",slug:"/integrations/providers/flyte",permalink:"/langchain/docs/integrations/providers/flyte",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"integrations",previous:{title:"Fireworks",permalink:"/langchain/docs/integrations/providers/fireworks"},next:{title:"ForefrontAI",permalink:"/langchain/docs/integrations/providers/forefrontai"}},s={},p=[{value:"Installation &amp; Setup",id:"installation--setup",level:2},{value:"Flyte Tasks",id:"flyte-tasks",level:2},{value:"LLM",id:"llm",level:3},{value:"Chain",id:"chain",level:3},{value:"Agent",id:"agent",level:3},{value:"Execute the Flyte Tasks on Kubernetes",id:"execute-the-flyte-tasks-on-kubernetes",level:2}],c={toc:p},u="wrapper";function m(e){let{components:t,...n}=e;return(0,r.kt)(u,(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"flyte"},"Flyte"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("a",{parentName:"p",href:"https://github.com/flyteorg/flyte"},"Flyte")," is an open-source orchestrator that facilitates building production-grade data and ML pipelines.\nIt is built for scalability and reproducibility, leveraging Kubernetes as its underlying platform.")),(0,r.kt)("p",null,"The purpose of this notebook is to demonstrate the integration of a ",(0,r.kt)("inlineCode",{parentName:"p"},"FlyteCallback")," into your Flyte task, enabling you to effectively monitor and track your LangChain experiments."),(0,r.kt)("h2",{id:"installation--setup"},"Installation & Setup"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Install the Flytekit library by running the command ",(0,r.kt)("inlineCode",{parentName:"li"},"pip install flytekit"),"."),(0,r.kt)("li",{parentName:"ul"},"Install the Flytekit-Envd plugin by running the command ",(0,r.kt)("inlineCode",{parentName:"li"},"pip install flytekitplugins-envd"),"."),(0,r.kt)("li",{parentName:"ul"},"Install LangChain by running the command ",(0,r.kt)("inlineCode",{parentName:"li"},"pip install langchain"),"."),(0,r.kt)("li",{parentName:"ul"},"Install ",(0,r.kt)("a",{parentName:"li",href:"https://docs.docker.com/engine/install/"},"Docker")," on your system.")),(0,r.kt)("h2",{id:"flyte-tasks"},"Flyte Tasks"),(0,r.kt)("p",null,"A Flyte ",(0,r.kt)("a",{parentName:"p",href:"https://docs.flyte.org/projects/cookbook/en/latest/auto/core/flyte_basics/task.html"},"task")," serves as the foundational building block of Flyte.\nTo execute LangChain experiments, you need to write Flyte tasks that define the specific steps and operations involved."),(0,r.kt)("p",null,"NOTE: The ",(0,r.kt)("a",{parentName:"p",href:"https://docs.flyte.org/projects/cookbook/en/latest/index.html"},"getting started guide")," offers detailed, step-by-step instructions on installing Flyte locally and running your initial Flyte pipeline."),(0,r.kt)("p",null,"First, import the necessary dependencies to support your LangChain experiments."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},"import os\n\nfrom flytekit import ImageSpec, task\nfrom langchain.agents import AgentType, initialize_agent, load_tools\nfrom langchain.callbacks import FlyteCallbackHandler\nfrom langchain.chains import LLMChain\nfrom langchain.chat_models import ChatOpenAI\nfrom langchain.prompts import PromptTemplate\nfrom langchain.schema import HumanMessage\n")),(0,r.kt)("p",null,"Set up the necessary environment variables to utilize the OpenAI API and Serp API:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'# Set OpenAI API key\nos.environ["OPENAI_API_KEY"] = "<your_openai_api_key>"\n\n# Set Serp API key\nos.environ["SERPAPI_API_KEY"] = "<your_serp_api_key>"\n')),(0,r.kt)("p",null,"Replace ",(0,r.kt)("inlineCode",{parentName:"p"},"<your_openai_api_key>")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"<your_serp_api_key>")," with your respective API keys obtained from OpenAI and Serp API."),(0,r.kt)("p",null,"To guarantee reproducibility of your pipelines, Flyte tasks are containerized.\nEach Flyte task must be associated with an image, which can either be shared across the entire Flyte ",(0,r.kt)("a",{parentName:"p",href:"https://docs.flyte.org/projects/cookbook/en/latest/auto/core/flyte_basics/basic_workflow.html"},"workflow")," or provided separately for each task."),(0,r.kt)("p",null,"To streamline the process of supplying the required dependencies for each Flyte task, you can initialize an ",(0,r.kt)("a",{parentName:"p",href:"https://docs.flyte.org/projects/cookbook/en/latest/auto/core/image_spec/image_spec.html"},(0,r.kt)("inlineCode",{parentName:"a"},"ImageSpec"))," object.\nThis approach automatically triggers a Docker build, alleviating the need for users to manually create a Docker image."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'custom_image = ImageSpec(\n    name="langchain-flyte",\n    packages=[\n        "langchain",\n        "openai",\n        "spacy",\n        "https://github.com/explosion/spacy-models/releases/download/en_core_web_sm-3.5.0/en_core_web_sm-3.5.0.tar.gz",\n        "textstat",\n        "google-search-results",\n    ],\n    registry="<your-registry>",\n)\n')),(0,r.kt)("p",null,"You have the flexibility to push the Docker image to a registry of your preference.\n",(0,r.kt)("a",{parentName:"p",href:"https://hub.docker.com/"},"Docker Hub")," or ",(0,r.kt)("a",{parentName:"p",href:"https://docs.github.com/en/packages/working-with-a-github-packages-registry/working-with-the-container-registry"},"GitHub Container Registry (GHCR)")," is a convenient option to begin with."),(0,r.kt)("p",null,"Once you have selected a registry, you can proceed to create Flyte tasks that log the LangChain metrics to Flyte Deck."),(0,r.kt)("p",null,"The following examples demonstrate tasks related to OpenAI LLM, chains and agent with tools:"),(0,r.kt)("h3",{id:"llm"},"LLM"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'@task(disable_deck=False, container_image=custom_image)\ndef langchain_llm() -> str:\n    llm = ChatOpenAI(\n        model_name="gpt-3.5-turbo",\n        temperature=0.2,\n        callbacks=[FlyteCallbackHandler()],\n    )\n    return llm([HumanMessage(content="Tell me a joke")]).content\n')),(0,r.kt)("h3",{id:"chain"},"Chain"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'@task(disable_deck=False, container_image=custom_image)\ndef langchain_chain() -> list[dict[str, str]]:\n    template = """You are a playwright. Given the title of play, it is your job to write a synopsis for that title.\nTitle: {title}\nPlaywright: This is a synopsis for the above play:"""\n    llm = ChatOpenAI(\n        model_name="gpt-3.5-turbo",\n        temperature=0,\n        callbacks=[FlyteCallbackHandler()],\n    )\n    prompt_template = PromptTemplate(input_variables=["title"], template=template)\n    synopsis_chain = LLMChain(\n        llm=llm, prompt=prompt_template, callbacks=[FlyteCallbackHandler()]\n    )\n    test_prompts = [\n        {\n            "title": "documentary about good video games that push the boundary of game design"\n        },\n    ]\n    return synopsis_chain.apply(test_prompts)\n')),(0,r.kt)("h3",{id:"agent"},"Agent"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'@task(disable_deck=False, container_image=custom_image)\ndef langchain_agent() -> str:\n    llm = OpenAI(\n        model_name="gpt-3.5-turbo",\n        temperature=0,\n        callbacks=[FlyteCallbackHandler()],\n    )\n    tools = load_tools(\n        ["serpapi", "llm-math"], llm=llm, callbacks=[FlyteCallbackHandler()]\n    )\n    agent = initialize_agent(\n        tools,\n        llm,\n        agent=AgentType.ZERO_SHOT_REACT_DESCRIPTION,\n        callbacks=[FlyteCallbackHandler()],\n        verbose=True,\n    )\n    return agent.run(\n        "Who is Leonardo DiCaprio\'s girlfriend? Could you calculate her current age and raise it to the power of 0.43?"\n    )\n')),(0,r.kt)("p",null,"These tasks serve as a starting point for running your LangChain experiments within Flyte."),(0,r.kt)("h2",{id:"execute-the-flyte-tasks-on-kubernetes"},"Execute the Flyte Tasks on Kubernetes"),(0,r.kt)("p",null,"To execute the Flyte tasks on the configured Flyte backend, use the following command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"pyflyte run --image <your-image> langchain_flyte.py langchain_llm\n")),(0,r.kt)("p",null,"This command will initiate the execution of the ",(0,r.kt)("inlineCode",{parentName:"p"},"langchain_llm")," task on the Flyte backend. You can trigger the remaining two tasks in a similar manner."),(0,r.kt)("p",null,"The metrics will be displayed on the Flyte UI as follows:"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://ik.imagekit.io/c8zl7irwkdda/Screenshot_2023-06-20_at_1.23.29_PM_MZYeG0dKa.png?updatedAt=1687247642993",alt:"LangChain LLM"})))}m.isMDXComponent=!0}}]);