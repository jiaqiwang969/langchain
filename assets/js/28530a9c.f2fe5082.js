"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[38995],{3905:(t,e,a)=>{a.d(e,{Zo:()=>c,kt:()=>g});var n=a(67294);function r(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function i(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,n)}return a}function l(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?i(Object(a),!0).forEach((function(e){r(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function o(t,e){if(null==t)return{};var a,n,r=function(t,e){if(null==t)return{};var a,n,r={},i=Object.keys(t);for(n=0;n<i.length;n++)a=i[n],e.indexOf(a)>=0||(r[a]=t[a]);return r}(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(n=0;n<i.length;n++)a=i[n],e.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(t,a)&&(r[a]=t[a])}return r}var s=n.createContext({}),p=function(t){var e=n.useContext(s),a=e;return t&&(a="function"==typeof t?t(e):l(l({},e),t)),a},c=function(t){var e=p(t.components);return n.createElement(s.Provider,{value:e},t.children)},d="mdxType",m={inlineCode:"code",wrapper:function(t){var e=t.children;return n.createElement(n.Fragment,{},e)}},k=n.forwardRef((function(t,e){var a=t.components,r=t.mdxType,i=t.originalType,s=t.parentName,c=o(t,["components","mdxType","originalType","parentName"]),d=p(a),k=r,g=d["".concat(s,".").concat(k)]||d[k]||m[k]||i;return a?n.createElement(g,l(l({ref:e},c),{},{components:a})):n.createElement(g,l({ref:e},c))}));function g(t,e){var a=arguments,r=e&&e.mdxType;if("string"==typeof t||r){var i=a.length,l=new Array(i);l[0]=k;var o={};for(var s in e)hasOwnProperty.call(e,s)&&(o[s]=e[s]);o.originalType=t,o[d]="string"==typeof t?t:r,l[1]=o;for(var p=2;p<i;p++)l[p]=a[p];return n.createElement.apply(null,l)}return n.createElement.apply(null,a)}k.displayName="MDXCreateElement"},59310:(t,e,a)=>{a.r(e),a.d(e,{assets:()=>s,contentTitle:()=>l,default:()=>m,frontMatter:()=>i,metadata:()=>o,toc:()=>p});var n=a(87462),r=(a(67294),a(3905));const i={},l="Portkey",o={unversionedId:"integrations/providers/portkey/index",id:"integrations/providers/portkey/index",title:"Portkey",description:"LLMOps for Langchain",source:"@site/docs/integrations/providers/portkey/index.md",sourceDirName:"integrations/providers/portkey",slug:"/integrations/providers/portkey/",permalink:"/langchain/docs/integrations/providers/portkey/",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"integrations",previous:{title:"PipelineAI",permalink:"/langchain/docs/integrations/providers/pipelineai"},next:{title:"logging_tracing_portkey",permalink:"/langchain/docs/integrations/providers/portkey/logging_tracing_portkey"}},s={},p=[{value:"LLMOps for Langchain",id:"llmops-for-langchain",level:2},{value:"Using Portkey with Langchain",id:"using-portkey-with-langchain",level:3},{value:"<strong>Tracing Chains &amp; Agents</strong>",id:"tracing-chains--agents",level:3},{value:"Advanced Features",id:"advanced-features",level:2},{value:"<strong>Enabling all Portkey Features:</strong>",id:"enabling-all-portkey-features",level:2}],c={toc:p},d="wrapper";function m(t){let{components:e,...a}=t;return(0,r.kt)(d,(0,n.Z)({},c,a,{components:e,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"portkey"},"Portkey"),(0,r.kt)("h2",{id:"llmops-for-langchain"},"LLMOps for Langchain"),(0,r.kt)("p",null,"Portkey brings production readiness to Langchain. With Portkey, you can "),(0,r.kt)("ul",{className:"contains-task-list"},(0,r.kt)("li",{parentName:"ul",className:"task-list-item"},(0,r.kt)("input",{parentName:"li",type:"checkbox",checked:!0,disabled:!0})," ","view detailed ",(0,r.kt)("strong",{parentName:"li"},"metrics & logs")," for all requests, "),(0,r.kt)("li",{parentName:"ul",className:"task-list-item"},(0,r.kt)("input",{parentName:"li",type:"checkbox",checked:!0,disabled:!0})," ","enable ",(0,r.kt)("strong",{parentName:"li"},"semantic cache")," to reduce latency & costs, "),(0,r.kt)("li",{parentName:"ul",className:"task-list-item"},(0,r.kt)("input",{parentName:"li",type:"checkbox",checked:!0,disabled:!0})," ","implement automatic ",(0,r.kt)("strong",{parentName:"li"},"retries & fallbacks")," for failed requests, "),(0,r.kt)("li",{parentName:"ul",className:"task-list-item"},(0,r.kt)("input",{parentName:"li",type:"checkbox",checked:!0,disabled:!0})," ","add ",(0,r.kt)("strong",{parentName:"li"},"custom tags")," to requests for better tracking and analysis and ",(0,r.kt)("a",{parentName:"li",href:"https://docs.portkey.ai"},"more"),".")),(0,r.kt)("h3",{id:"using-portkey-with-langchain"},"Using Portkey with Langchain"),(0,r.kt)("p",null,"Using Portkey is as simple as just choosing which Portkey features you want, enabling them via ",(0,r.kt)("inlineCode",{parentName:"p"},"headers=Portkey.Config")," and passing it in your LLM calls."),(0,r.kt)("p",null,"To start, get your Portkey API key by ",(0,r.kt)("a",{parentName:"p",href:"https://app.portkey.ai/login"},"signing up here"),'. (Click the profile icon on the top left, then click on "Copy API Key")'),(0,r.kt)("p",null,"For OpenAI, a simple integration with logging feature would look like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'\x3c!--IMPORTS:[{"imported": "OpenAI", "source": "langchain.llms", "docs": "https://api.python.langchain.com/en/latest/llms/langchain.llms.openai.OpenAI.html", "title": "Portkey"}, {"imported": "Portkey", "source": "langchain.utilities", "docs": "https://api.python.langchain.com/en/latest/utilities/langchain.utilities.portkey.Portkey.html", "title": "Portkey"}]--\x3e\nfrom langchain.llms import OpenAI\nfrom langchain.utilities import Portkey\n\n# Add the Portkey API Key from your account\nheaders = Portkey.Config(\n    api_key = "<PORTKEY_API_KEY>"\n)\n\nllm = OpenAI(temperature=0.9, headers=headers)\nllm.predict("What would be a good company name for a company that makes colorful socks?")\n')),(0,r.kt)("p",null,"Your logs will be captured on your ",(0,r.kt)("a",{parentName:"p",href:"https://app.portkey.ai"},"Portkey dashboard"),"."),(0,r.kt)("p",null,"A common Portkey X Langchain use case is to ",(0,r.kt)("strong",{parentName:"p"},"trace a chain or an agent")," and view all the LLM calls originating from that request. "),(0,r.kt)("h3",{id:"tracing-chains--agents"},(0,r.kt)("strong",{parentName:"h3"},"Tracing Chains & Agents")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'\x3c!--IMPORTS:[{"imported": "AgentType", "source": "langchain.agents", "docs": "https://api.python.langchain.com/en/latest/agents/langchain.agents.agent_types.AgentType.html", "title": "Portkey"}, {"imported": "initialize_agent", "source": "langchain.agents", "docs": "https://api.python.langchain.com/en/latest/agents/langchain.agents.initialize.initialize_agent.html", "title": "Portkey"}, {"imported": "load_tools", "source": "langchain.agents", "docs": "https://api.python.langchain.com/en/latest/agents/langchain.agents.load_tools.load_tools.html", "title": "Portkey"}, {"imported": "OpenAI", "source": "langchain.llms", "docs": "https://api.python.langchain.com/en/latest/llms/langchain.llms.openai.OpenAI.html", "title": "Portkey"}, {"imported": "Portkey", "source": "langchain.utilities", "docs": "https://api.python.langchain.com/en/latest/utilities/langchain.utilities.portkey.Portkey.html", "title": "Portkey"}]--\x3e\nfrom langchain.agents import AgentType, initialize_agent, load_tools  \nfrom langchain.llms import OpenAI\nfrom langchain.utilities import Portkey\n\n# Add the Portkey API Key from your account\nheaders = Portkey.Config(\n    api_key = "<PORTKEY_API_KEY>",\n    trace_id = "fef659"\n)\n\nllm = OpenAI(temperature=0, headers=headers)  \ntools = load_tools(["serpapi", "llm-math"], llm=llm)  \nagent = initialize_agent(tools, llm, agent=AgentType.ZERO_SHOT_REACT_DESCRIPTION, verbose=True)  \n  \n# Let\'s test it out!  \nagent.run("What was the high temperature in SF yesterday in Fahrenheit? What is that number raised to the .023 power?")\n')),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"You can see the requests' logs along with the trace id on Portkey dashboard:")),(0,r.kt)("img",{src:"/img/portkey-dashboard.gif",height:"250"}),(0,r.kt)("img",{src:"/img/portkey-tracing.png",height:"250"}),(0,r.kt)("h2",{id:"advanced-features"},"Advanced Features"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Logging:")," Log all your LLM requests automatically by sending them through Portkey. Each request log contains ",(0,r.kt)("inlineCode",{parentName:"li"},"timestamp"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"model name"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"total cost"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"request time"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"request json"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"response json"),", and additional Portkey features."),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Tracing:")," Trace id can be passed along with each request and is visibe on the logs on Portkey dashboard. You can also set a ",(0,r.kt)("strong",{parentName:"li"},"distinct trace id")," for each request. You can ",(0,r.kt)("a",{parentName:"li",href:"https://docs.portkey.ai/key-features/feedback-api"},"append user feedback")," to a trace id as well."),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Caching:")," Respond to previously served customers queries from cache instead of sending them again to OpenAI. Match exact strings OR semantically similar strings. Cache can save costs and reduce latencies by 20x."),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Retries:")," Automatically reprocess any unsuccessful API requests ",(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"upto 5"))," times. Uses an ",(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"exponential backoff"))," strategy, which spaces out retry attempts to prevent network overload."),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Tagging:")," Track and audit each user interaction in high detail with predefined tags.")),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Feature"),(0,r.kt)("th",{parentName:"tr",align:null},"Config Key"),(0,r.kt)("th",{parentName:"tr",align:null},"Value (Type)"),(0,r.kt)("th",{parentName:"tr",align:null},"Required/Optional"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"API Key"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"api_key")),(0,r.kt)("td",{parentName:"tr",align:null},"API Key (",(0,r.kt)("inlineCode",{parentName:"td"},"string"),")"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2705 Required")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"https://docs.portkey.ai/key-features/request-tracing"},"Tracing Requests")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"trace_id")),(0,r.kt)("td",{parentName:"tr",align:null},"Custom ",(0,r.kt)("inlineCode",{parentName:"td"},"string")),(0,r.kt)("td",{parentName:"tr",align:null},"\u2754 Optional")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"https://docs.portkey.ai/key-features/automatic-retries"},"Automatic Retries")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"retry_count")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"integer")," ","[1,2,3,4,5]"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2754 Optional")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"https://docs.portkey.ai/key-features/request-caching"},"Enabling Cache")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"cache")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"simple")," OR ",(0,r.kt)("inlineCode",{parentName:"td"},"semantic")),(0,r.kt)("td",{parentName:"tr",align:null},"\u2754 Optional")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Cache Force Refresh"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"cache_force_refresh")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"True")),(0,r.kt)("td",{parentName:"tr",align:null},"\u2754 Optional")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Set Cache Expiry"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"cache_age")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"integer")," (in seconds)"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2754 Optional")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"https://docs.portkey.ai/key-features/custom-metadata"},"Add User")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"user")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"string")),(0,r.kt)("td",{parentName:"tr",align:null},"\u2754 Optional")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"https://docs.portkey.ai/key-features/custom-metadata"},"Add Organisation")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"organisation")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"string")),(0,r.kt)("td",{parentName:"tr",align:null},"\u2754 Optional")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"https://docs.portkey.ai/key-features/custom-metadata"},"Add Environment")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"environment")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"string")),(0,r.kt)("td",{parentName:"tr",align:null},"\u2754 Optional")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"https://docs.portkey.ai/key-features/custom-metadata"},"Add Prompt (version/id/string)")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"prompt")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"string")),(0,r.kt)("td",{parentName:"tr",align:null},"\u2754 Optional")))),(0,r.kt)("h2",{id:"enabling-all-portkey-features"},(0,r.kt)("strong",{parentName:"h2"},"Enabling all Portkey Features:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-py"},'headers = Portkey.Config(\n    \n    # Mandatory\n    api_key="<PORTKEY_API_KEY>",  \n    \n    # Cache Options\n    cache="semantic",                 \n    cache_force_refresh="True",             \n    cache_age=1729,  \n\n    # Advanced\n    retry_count=5,                                           \n    trace_id="langchain_agent",                          \n\n    # Metadata\n    environment="production",        \n    user="john",                      \n    organisation="acme",             \n    prompt="Frost"\n    \n)\n')),(0,r.kt)("p",null,"For detailed information on each feature and how to use it, ",(0,r.kt)("a",{parentName:"p",href:"https://docs.portkey.ai"},"please refer to the Portkey docs"),". If you have any questions or need further assistance, ",(0,r.kt)("a",{parentName:"p",href:"https://twitter.com/portkeyai"},"reach out to us on Twitter."),"."))}m.isMDXComponent=!0}}]);