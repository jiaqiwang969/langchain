"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[17691],{3905:(e,a,t)=>{t.d(a,{Zo:()=>u,kt:()=>m});var n=t(67294);function o(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function r(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,n)}return t}function i(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?r(Object(t),!0).forEach((function(a){o(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function l(e,a){if(null==e)return{};var t,n,o=function(e,a){if(null==e)return{};var t,n,o={},r=Object.keys(e);for(n=0;n<r.length;n++)t=r[n],a.indexOf(t)>=0||(o[t]=e[t]);return o}(e,a);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)t=r[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var p=n.createContext({}),s=function(e){var a=n.useContext(p),t=a;return e&&(t="function"==typeof e?e(a):i(i({},a),e)),t},u=function(e){var a=s(e.components);return n.createElement(p.Provider,{value:a},e.children)},c="mdxType",d={inlineCode:"code",wrapper:function(e){var a=e.children;return n.createElement(n.Fragment,{},a)}},h=n.forwardRef((function(e,a){var t=e.components,o=e.mdxType,r=e.originalType,p=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),c=s(t),h=o,m=c["".concat(p,".").concat(h)]||c[h]||d[h]||r;return t?n.createElement(m,i(i({ref:a},u),{},{components:t})):n.createElement(m,i({ref:a},u))}));function m(e,a){var t=arguments,o=a&&a.mdxType;if("string"==typeof e||o){var r=t.length,i=new Array(r);i[0]=h;var l={};for(var p in a)hasOwnProperty.call(a,p)&&(l[p]=a[p]);l.originalType=e,l[c]="string"==typeof e?e:o,i[1]=l;for(var s=2;s<r;s++)i[s]=t[s];return n.createElement.apply(null,i)}return n.createElement.apply(null,t)}h.displayName="MDXCreateElement"},57466:(e,a,t)=>{t.r(a),t.d(a,{assets:()=>p,contentTitle:()=>i,default:()=>m,frontMatter:()=>r,metadata:()=>l,toc:()=>s});var n=t(87462),o=(t(67294),t(3905));const r={},i="Natural Language APIs",l={unversionedId:"integrations/toolkits/openapi_nla",id:"integrations/toolkits/openapi_nla",title:"Natural Language APIs",description:"Natural Language API Toolkits (NLAToolkits) permit LangChain Agents to efficiently plan and combine calls across endpoints.",source:"@site/docs/integrations/toolkits/openapi_nla.md",sourceDirName:"integrations/toolkits",slug:"/integrations/toolkits/openapi_nla",permalink:"/langchain/docs/integrations/toolkits/openapi_nla",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"integrations",previous:{title:"OpenAPI",permalink:"/langchain/docs/integrations/toolkits/openapi"},next:{title:"Pandas Dataframe",permalink:"/langchain/docs/integrations/toolkits/pandas"}},p={},s=[{value:"First, import dependencies and load the LLM",id:"first-import-dependencies-and-load-the-llm",level:3},{value:"Next, load the Natural Language API Toolkits",id:"next-load-the-natural-language-api-toolkits",level:3},{value:"Create the Agent",id:"create-the-agent",level:3},{value:"Use Auth and add more Endpoints",id:"use-auth-and-add-more-endpoints",level:3},{value:"Thank you!",id:"thank-you",level:2}],u=(c="CodeOutputBlock",function(e){return console.warn("Component "+c+" was not imported, exported, or provided by MDXProvider as global scope"),(0,o.kt)("div",e)});var c;const d={toc:s},h="wrapper";function m(e){let{components:a,...t}=e;return(0,o.kt)(h,(0,n.Z)({},d,t,{components:a,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"natural-language-apis"},"Natural Language APIs"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"Natural Language API")," Toolkits (",(0,o.kt)("inlineCode",{parentName:"p"},"NLAToolkits"),") permit LangChain Agents to efficiently plan and combine calls across endpoints. "),(0,o.kt)("p",null,"This notebook demonstrates a sample composition of the ",(0,o.kt)("inlineCode",{parentName:"p"},"Speak"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"Klarna"),", and ",(0,o.kt)("inlineCode",{parentName:"p"},"Spoonacluar")," APIs."),(0,o.kt)("p",null,"For a detailed walkthrough of the OpenAPI chains wrapped within the NLAToolkit, see the ",(0,o.kt)("a",{parentName:"p",href:"/docs/use_cases/apis/openapi.html"},"OpenAPI Operation Chain")," notebook."),(0,o.kt)("h3",{id:"first-import-dependencies-and-load-the-llm"},"First, import dependencies and load the LLM"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'\x3c!--IMPORTS:[{"imported": "LLMChain", "source": "langchain.chains", "docs": "https://api.python.langchain.com/en/latest/chains/langchain.chains.llm.LLMChain.html", "title": "Natural Language APIs"}, {"imported": "OpenAI", "source": "langchain.llms", "docs": "https://api.python.langchain.com/en/latest/llms/langchain.llms.openai.OpenAI.html", "title": "Natural Language APIs"}, {"imported": "PromptTemplate", "source": "langchain.prompts", "docs": "https://api.python.langchain.com/en/latest/prompts/langchain.prompts.prompt.PromptTemplate.html", "title": "Natural Language APIs"}, {"imported": "Requests", "source": "langchain.requests", "docs": "https://api.python.langchain.com/en/latest/utilities/langchain.utilities.requests.Requests.html", "title": "Natural Language APIs"}, {"imported": "APIOperation", "source": "langchain.tools", "docs": "https://api.python.langchain.com/en/latest/tools/langchain.tools.openapi.utils.api_models.APIOperation.html", "title": "Natural Language APIs"}, {"imported": "OpenAPISpec", "source": "langchain.tools", "docs": "https://api.python.langchain.com/en/latest/utilities/langchain.utilities.openapi.OpenAPISpec.html", "title": "Natural Language APIs"}, {"imported": "AgentType", "source": "langchain.agents", "docs": "https://api.python.langchain.com/en/latest/agents/langchain.agents.agent_types.AgentType.html", "title": "Natural Language APIs"}, {"imported": "Tool", "source": "langchain.agents", "docs": "https://api.python.langchain.com/en/latest/tools/langchain.tools.base.Tool.html", "title": "Natural Language APIs"}, {"imported": "initialize_agent", "source": "langchain.agents", "docs": "https://api.python.langchain.com/en/latest/agents/langchain.agents.initialize.initialize_agent.html", "title": "Natural Language APIs"}, {"imported": "NLAToolkit", "source": "langchain.agents.agent_toolkits", "docs": "https://api.python.langchain.com/en/latest/agents/langchain.agents.agent_toolkits.nla.toolkit.NLAToolkit.html", "title": "Natural Language APIs"}]--\x3e\nfrom typing import List, Optional\nfrom langchain.chains import LLMChain\nfrom langchain.llms import OpenAI\nfrom langchain.prompts import PromptTemplate\nfrom langchain.requests import Requests\nfrom langchain.tools import APIOperation, OpenAPISpec\nfrom langchain.agents import AgentType, Tool, initialize_agent\nfrom langchain.agents.agent_toolkits import NLAToolkit\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},"# Select the LLM to use. Here, we use text-davinci-003\nllm = OpenAI(\n    temperature=0, max_tokens=700\n)  # You can swap between different core LLM's here.\n")),(0,o.kt)("h3",{id:"next-load-the-natural-language-api-toolkits"},"Next, load the Natural Language API Toolkits"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'speak_toolkit = NLAToolkit.from_llm_and_url(llm, "https://api.speak.com/openapi.yaml")\nklarna_toolkit = NLAToolkit.from_llm_and_url(\n    llm, "https://www.klarna.com/us/shopping/public/openai/v0/api-docs/"\n)\n')),(0,o.kt)(u,{lang:"python",mdxType:"CodeOutputBlock"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"    Attempting to load an OpenAPI 3.0.1 spec.  This may result in degraded performance. Convert your OpenAPI spec to 3.1.* spec for better support.\n    Attempting to load an OpenAPI 3.0.1 spec.  This may result in degraded performance. Convert your OpenAPI spec to 3.1.* spec for better support.\n    Attempting to load an OpenAPI 3.0.1 spec.  This may result in degraded performance. Convert your OpenAPI spec to 3.1.* spec for better support.\n"))),(0,o.kt)("h3",{id:"create-the-agent"},"Create the Agent"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'# Slightly tweak the instructions from the default agent\nopenapi_format_instructions = """Use the following format:\n\nQuestion: the input question you must answer\nThought: you should always think about what to do\nAction: the action to take, should be one of [{tool_names}]\nAction Input: what to instruct the AI Action representative.\nObservation: The Agent\'s response\n... (this Thought/Action/Action Input/Observation can repeat N times)\nThought: I now know the final answer. User can\'t see any of my observations, API responses, links, or tools.\nFinal Answer: the final answer to the original input question with the right amount of detail\n\nWhen responding with your Final Answer, remember that the person you are responding to CANNOT see any of your Thought/Action/Action Input/Observations, so if there is any relevant information there you need to include it explicitly in your response."""\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'natural_language_tools = speak_toolkit.get_tools() + klarna_toolkit.get_tools()\nmrkl = initialize_agent(\n    natural_language_tools,\n    llm,\n    agent=AgentType.ZERO_SHOT_REACT_DESCRIPTION,\n    verbose=True,\n    agent_kwargs={"format_instructions": openapi_format_instructions},\n)\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'mrkl.run(\n    "I have an end of year party for my Italian class and have to buy some Italian clothes for it"\n)\n')),(0,o.kt)(u,{lang:"python",mdxType:"CodeOutputBlock"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"    \n    \n    > Entering new AgentExecutor chain...\n     I need to find out what kind of Italian clothes are available\n    Action: Open_AI_Klarna_product_Api.productsUsingGET\n    Action Input: Italian clothes\n    Observation: The API response contains two products from the Al\xe9 brand in Italian Blue. The first is the Al\xe9 Colour Block Short Sleeve Jersey Men - Italian Blue, which costs $86.49, and the second is the Al\xe9 Dolid Flash Jersey Men - Italian Blue, which costs $40.00.\n    Thought: I now know what kind of Italian clothes are available and how much they cost.\n    Final Answer: You can buy two products from the Al\xe9 brand in Italian Blue for your end of year party. The Al\xe9 Colour Block Short Sleeve Jersey Men - Italian Blue costs $86.49, and the Al\xe9 Dolid Flash Jersey Men - Italian Blue costs $40.00.\n    \n    > Finished chain.\n\n\n\n\n\n    'You can buy two products from the Al\xe9 brand in Italian Blue for your end of year party. The Al\xe9 Colour Block Short Sleeve Jersey Men - Italian Blue costs $86.49, and the Al\xe9 Dolid Flash Jersey Men - Italian Blue costs $40.00.'\n"))),(0,o.kt)("h3",{id:"use-auth-and-add-more-endpoints"},"Use Auth and add more Endpoints"),(0,o.kt)("p",null,"Some endpoints may require user authentication via things like access tokens. Here we show how to pass in the authentication information via the ",(0,o.kt)("inlineCode",{parentName:"p"},"Requests")," wrapper object."),(0,o.kt)("p",null,"Since each NLATool exposes a concisee natural language interface to its wrapped API, the top level conversational agent has an easier job incorporating each endpoint to satisfy a user's request."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Adding the Spoonacular endpoints.")),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Go to the ",(0,o.kt)("a",{parentName:"li",href:"https://spoonacular.com/food-api/console#Profile"},"Spoonacular API Console")," and make a free account."),(0,o.kt)("li",{parentName:"ol"},"Click on ",(0,o.kt)("inlineCode",{parentName:"li"},"Profile")," and copy your API key below.")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'spoonacular_api_key = ""  # Copy from the API Console\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'requests = Requests(headers={"x-api-key": spoonacular_api_key})\nspoonacular_toolkit = NLAToolkit.from_llm_and_url(\n    llm,\n    "https://spoonacular.com/application/frontend/downloads/spoonacular-openapi-3.json",\n    requests=requests,\n    max_text_length=1800,  # If you want to truncate the response text\n)\n')),(0,o.kt)(u,{lang:"python",mdxType:"CodeOutputBlock"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"    Attempting to load an OpenAPI 3.0.0 spec.  This may result in degraded performance. Convert your OpenAPI spec to 3.1.* spec for better support.\n    Unsupported APIPropertyLocation \"header\" for parameter Content-Type. Valid values are ['path', 'query'] Ignoring optional parameter\n    Unsupported APIPropertyLocation \"header\" for parameter Accept. Valid values are ['path', 'query'] Ignoring optional parameter\n    Unsupported APIPropertyLocation \"header\" for parameter Content-Type. Valid values are ['path', 'query'] Ignoring optional parameter\n    Unsupported APIPropertyLocation \"header\" for parameter Accept. Valid values are ['path', 'query'] Ignoring optional parameter\n    Unsupported APIPropertyLocation \"header\" for parameter Content-Type. Valid values are ['path', 'query'] Ignoring optional parameter\n    Unsupported APIPropertyLocation \"header\" for parameter Accept. Valid values are ['path', 'query'] Ignoring optional parameter\n    Unsupported APIPropertyLocation \"header\" for parameter Content-Type. Valid values are ['path', 'query'] Ignoring optional parameter\n    Unsupported APIPropertyLocation \"header\" for parameter Accept. Valid values are ['path', 'query'] Ignoring optional parameter\n    Unsupported APIPropertyLocation \"header\" for parameter Content-Type. Valid values are ['path', 'query'] Ignoring optional parameter\n    Unsupported APIPropertyLocation \"header\" for parameter Content-Type. Valid values are ['path', 'query'] Ignoring optional parameter\n    Unsupported APIPropertyLocation \"header\" for parameter Content-Type. Valid values are ['path', 'query'] Ignoring optional parameter\n    Unsupported APIPropertyLocation \"header\" for parameter Content-Type. Valid values are ['path', 'query'] Ignoring optional parameter\n    Unsupported APIPropertyLocation \"header\" for parameter Accept. Valid values are ['path', 'query'] Ignoring optional parameter\n    Unsupported APIPropertyLocation \"header\" for parameter Content-Type. Valid values are ['path', 'query'] Ignoring optional parameter\n    Unsupported APIPropertyLocation \"header\" for parameter Accept. Valid values are ['path', 'query'] Ignoring optional parameter\n    Unsupported APIPropertyLocation \"header\" for parameter Accept. Valid values are ['path', 'query'] Ignoring optional parameter\n    Unsupported APIPropertyLocation \"header\" for parameter Accept. Valid values are ['path', 'query'] Ignoring optional parameter\n    Unsupported APIPropertyLocation \"header\" for parameter Content-Type. Valid values are ['path', 'query'] Ignoring optional parameter\n"))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'natural_language_api_tools = (\n    speak_toolkit.get_tools()\n    + klarna_toolkit.get_tools()\n    + spoonacular_toolkit.get_tools()[:30]\n)\nprint(f"{len(natural_language_api_tools)} tools loaded.")\n')),(0,o.kt)(u,{lang:"python",mdxType:"CodeOutputBlock"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"    34 tools loaded.\n"))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'# Create an agent with the new tools\nmrkl = initialize_agent(\n    natural_language_api_tools,\n    llm,\n    agent=AgentType.ZERO_SHOT_REACT_DESCRIPTION,\n    verbose=True,\n    agent_kwargs={"format_instructions": openapi_format_instructions},\n)\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'# Make the query more complex!\nuser_input = (\n    "I\'m learning Italian, and my language class is having an end of year party... "\n    " Could you help me find an Italian outfit to wear and"\n    " an appropriate recipe to prepare so I can present for the class in Italian?"\n)\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},"mrkl.run(user_input)\n")),(0,o.kt)(u,{lang:"python",mdxType:"CodeOutputBlock"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"    \n    \n    > Entering new AgentExecutor chain...\n     I need to find a recipe and an outfit that is Italian-themed.\n    Action: spoonacular_API.searchRecipes\n    Action Input: Italian\n    Observation: The API response contains 10 Italian recipes, including Turkey Tomato Cheese Pizza, Broccolini Quinoa Pilaf, Bruschetta Style Pork & Pasta, Salmon Quinoa Risotto, Italian Tuna Pasta, Roasted Brussels Sprouts With Garlic, Asparagus Lemon Risotto, Italian Steamed Artichokes, Crispy Italian Cauliflower Poppers Appetizer, and Pappa Al Pomodoro.\n    Thought: I need to find an Italian-themed outfit.\n    Action: Open_AI_Klarna_product_Api.productsUsingGET\n    Action Input: Italian\n    Observation: I found 10 products related to 'Italian' in the API response. These products include Italian Gold Sparkle Perfectina Necklace - Gold, Italian Design Miami Cuban Link Chain Necklace - Gold, Italian Gold Miami Cuban Link Chain Necklace - Gold, Italian Gold Herringbone Necklace - Gold, Italian Gold Claddagh Ring - Gold, Italian Gold Herringbone Chain Necklace - Gold, Garmin QuickFit 22mm Italian Vacchetta Leather Band, Macy's Italian Horn Charm - Gold, Dolce & Gabbana Light Blue Italian Love Pour Homme EdT 1.7 fl oz.\n    Thought: I now know the final answer.\n    Final Answer: To present for your Italian language class, you could wear an Italian Gold Sparkle Perfectina Necklace - Gold, an Italian Design Miami Cuban Link Chain Necklace - Gold, or an Italian Gold Miami Cuban Link Chain Necklace - Gold. For a recipe, you could make Turkey Tomato Cheese Pizza, Broccolini Quinoa Pilaf, Bruschetta Style Pork & Pasta, Salmon Quinoa Risotto, Italian Tuna Pasta, Roasted Brussels Sprouts With Garlic, Asparagus Lemon Risotto, Italian Steamed Artichokes, Crispy Italian Cauliflower Poppers Appetizer, or Pappa Al Pomodoro.\n    \n    > Finished chain.\n\n\n\n\n\n    'To present for your Italian language class, you could wear an Italian Gold Sparkle Perfectina Necklace - Gold, an Italian Design Miami Cuban Link Chain Necklace - Gold, or an Italian Gold Miami Cuban Link Chain Necklace - Gold. For a recipe, you could make Turkey Tomato Cheese Pizza, Broccolini Quinoa Pilaf, Bruschetta Style Pork & Pasta, Salmon Quinoa Risotto, Italian Tuna Pasta, Roasted Brussels Sprouts With Garlic, Asparagus Lemon Risotto, Italian Steamed Artichokes, Crispy Italian Cauliflower Poppers Appetizer, or Pappa Al Pomodoro.'\n"))),(0,o.kt)("h2",{id:"thank-you"},"Thank you!"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},"natural_language_api_tools[1].run(\n    \"Tell the LangChain audience to 'enjoy the meal' in Italian, please!\"\n)\n")),(0,o.kt)(u,{lang:"python",mdxType:"CodeOutputBlock"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"    \"In Italian, you can say 'Buon appetito' to someone to wish them to enjoy their meal. This phrase is commonly used in Italy when someone is about to eat, often at the beginning of a meal. It's similar to saying 'Bon app\xe9tit' in French or 'Guten Appetit' in German.\"\n"))))}m.isMDXComponent=!0}}]);