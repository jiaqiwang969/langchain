"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[56740],{3905:(e,a,n)=>{n.d(a,{Zo:()=>p,kt:()=>m});var t=n(67294);function r(e,a,n){return a in e?Object.defineProperty(e,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[a]=n,e}function l(e,a){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);a&&(t=t.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),n.push.apply(n,t)}return n}function o(e){for(var a=1;a<arguments.length;a++){var n=null!=arguments[a]?arguments[a]:{};a%2?l(Object(n),!0).forEach((function(a){r(e,a,n[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(n,a))}))}return e}function s(e,a){if(null==e)return{};var n,t,r=function(e,a){if(null==e)return{};var n,t,r={},l=Object.keys(e);for(t=0;t<l.length;t++)n=l[t],a.indexOf(n)>=0||(r[n]=e[n]);return r}(e,a);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(t=0;t<l.length;t++)n=l[t],a.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var i=t.createContext({}),c=function(e){var a=t.useContext(i),n=a;return e&&(n="function"==typeof e?e(a):o(o({},a),e)),n},p=function(e){var a=c(e.components);return t.createElement(i.Provider,{value:a},e.children)},h="mdxType",g={inlineCode:"code",wrapper:function(e){var a=e.children;return t.createElement(t.Fragment,{},a)}},d=t.forwardRef((function(e,a){var n=e.components,r=e.mdxType,l=e.originalType,i=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),h=c(n),d=r,m=h["".concat(i,".").concat(d)]||h[d]||g[d]||l;return n?t.createElement(m,o(o({ref:a},p),{},{components:n})):t.createElement(m,o({ref:a},p))}));function m(e,a){var n=arguments,r=a&&a.mdxType;if("string"==typeof e||r){var l=n.length,o=new Array(l);o[0]=d;var s={};for(var i in a)hasOwnProperty.call(a,i)&&(s[i]=a[i]);s.originalType=e,s[h]="string"==typeof e?e:r,o[1]=s;for(var c=2;c<l;c++)o[c]=n[c];return t.createElement.apply(null,o)}return t.createElement.apply(null,n)}d.displayName="MDXCreateElement"},84685:(e,a,n)=>{n.r(a),n.d(a,{assets:()=>i,contentTitle:()=>o,default:()=>m,frontMatter:()=>l,metadata:()=>s,toc:()=>c});var t=n(87462),r=(n(67294),n(3905));const l={},o="Weights & Biases",s={unversionedId:"integrations/providers/wandb_tracking",id:"integrations/providers/wandb_tracking",title:"Weights & Biases",description:"This notebook goes over how to track your LangChain experiments into one centralized Weights and Biases dashboard. To learn more about prompt engineering and the callback please refer to this Report which explains both alongside the resultant dashboards you can expect to see.",source:"@site/docs/integrations/providers/wandb_tracking.md",sourceDirName:"integrations/providers",slug:"/integrations/providers/wandb_tracking",permalink:"/langchain/docs/integrations/providers/wandb_tracking",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"integrations",previous:{title:"WandB Tracing",permalink:"/langchain/docs/integrations/providers/wandb_tracing"},next:{title:"Weather",permalink:"/langchain/docs/integrations/providers/weather"}},i={},c=[],p=(h="HTMLOutputBlock",function(e){return console.warn("Component "+h+" was not imported, exported, or provided by MDXProvider as global scope"),(0,r.kt)("div",e)});var h;const g={toc:c},d="wrapper";function m(e){let{components:a,...n}=e;return(0,r.kt)(d,(0,t.Z)({},g,n,{components:a,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"weights--biases"},"Weights & Biases"),(0,r.kt)("p",null,"This notebook goes over how to track your LangChain experiments into one centralized Weights and Biases dashboard. To learn more about prompt engineering and the callback please refer to this Report which explains both alongside the resultant dashboards you can expect to see."),(0,r.kt)("a",{href:"https://colab.research.google.com/drive/1DXH4beT4HFaRKy_Vm4PoxhXVDRf7Ym8L?usp=sharing",target:"_parent"},(0,r.kt)("img",{src:"https://colab.research.google.com/assets/colab-badge.svg",alt:"Open In Colab"})),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://wandb.ai/a-sh0ts/langchain_callback_demo/reports/Prompt-Engineering-LLMs-with-LangChain-and-W-B--VmlldzozNjk1NTUw#%F0%9F%91%8B-how-to-build-a-callback-in-langchain-for-better-prompt-engineering"},"View Report")," "),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Note"),": ",(0,r.kt)("em",{parentName:"p"},"the ",(0,r.kt)("inlineCode",{parentName:"em"},"WandbCallbackHandler")," is being deprecated in favour of the ",(0,r.kt)("inlineCode",{parentName:"em"},"WandbTracer"))," . In future please use the ",(0,r.kt)("inlineCode",{parentName:"p"},"WandbTracer")," as it is more flexible and allows for more granular logging. To know more about the ",(0,r.kt)("inlineCode",{parentName:"p"},"WandbTracer")," refer to the ",(0,r.kt)("a",{parentName:"p",href:"https://python.langchain.com/en/latest/integrations/agent_with_wandb_tracing.html"},"agent_with_wandb_tracing.html")," notebook or use the following ",(0,r.kt)("a",{parentName:"p",href:"http://wandb.me/prompts-quickstart"},"colab notebook"),". To know more about Weights & Biases Prompts refer to the following ",(0,r.kt)("a",{parentName:"p",href:"https://docs.wandb.ai/guides/prompts"},"prompts documentation"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"pip install wandb\npip install pandas\npip install textstat\npip install spacy\npython -m spacy download en_core_web_sm\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'import os\n\nos.environ["WANDB_API_KEY"] = ""\n# os.environ["OPENAI_API_KEY"] = ""\n# os.environ["SERPAPI_API_KEY"] = ""\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'\x3c!--IMPORTS:[{"imported": "WandbCallbackHandler", "source": "langchain.callbacks", "docs": "https://api.python.langchain.com/en/latest/callbacks/langchain.callbacks.wandb_callback.WandbCallbackHandler.html", "title": "Weights & Biases"}, {"imported": "StdOutCallbackHandler", "source": "langchain.callbacks", "docs": "https://api.python.langchain.com/en/latest/callbacks/langchain.callbacks.stdout.StdOutCallbackHandler.html", "title": "Weights & Biases"}, {"imported": "OpenAI", "source": "langchain.llms", "docs": "https://api.python.langchain.com/en/latest/llms/langchain.llms.openai.OpenAI.html", "title": "Weights & Biases"}]--\x3e\nfrom datetime import datetime\nfrom langchain.callbacks import WandbCallbackHandler, StdOutCallbackHandler\nfrom langchain.llms import OpenAI\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"Callback Handler that logs to Weights and Biases.\n\nParameters:\n    job_type (str): The type of job.\n    project (str): The project to log to.\n    entity (str): The entity to log to.\n    tags (list): The tags to log.\n    group (str): The group to log to.\n    name (str): The name of the run.\n    notes (str): The notes to log.\n    visualize (bool): Whether to visualize the run.\n    complexity_metrics (bool): Whether to log complexity metrics.\n    stream_logs (bool): Whether to stream callback actions to W&B\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"Default values for WandbCallbackHandler(...)\n\nvisualize: bool = False,\ncomplexity_metrics: bool = False,\nstream_logs: bool = False,\n")),(0,r.kt)("p",null,"NOTE: For beta workflows we have made the default analysis based on textstat and the visualizations based on spacy"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'"""Main function.\n\nThis function is used to try the callback handler.\nScenarios:\n1. OpenAI LLM\n2. Chain with multiple SubChains on multiple generations\n3. Agent with Tools\n"""\nsession_group = datetime.now().strftime("%m.%d.%Y_%H.%M.%S")\nwandb_callback = WandbCallbackHandler(\n    job_type="inference",\n    project="langchain_callback_demo",\n    group=f"minimal_{session_group}",\n    name="llm",\n    tags=["test"],\n)\ncallbacks = [StdOutCallbackHandler(), wandb_callback]\nllm = OpenAI(temperature=0, callbacks=callbacks)\n')),(0,r.kt)(p,{center:!0,mdxType:"HTMLOutputBlock"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"\x1b[34m\x1b[1mwandb\x1b[0m: Currently logged in as: \x1b[33mharrison-chase\x1b[0m. Use \x1b[1m`wandb login --relogin`\x1b[0m to force relogin\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},"Tracking run with wandb version 0.14.0\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},"Run data is saved locally in <code>/Users/harrisonchase/workplace/langchain/docs/ecosystem/wandb/run-20230318_150408-e47j1914</code>\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},"Syncing run <strong><a href='https://wandb.ai/harrison-chase/langchain_callback_demo/runs/e47j1914' target=\"_blank\">llm</a></strong> to <a href='https://wandb.ai/harrison-chase/langchain_callback_demo' target=\"_blank\">Weights & Biases</a> (<a href='https://wandb.me/run' target=\"_blank\">docs</a>)<br/>\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},"View project at <a href='https://wandb.ai/harrison-chase/langchain_callback_demo' target=\"_blank\">https://wandb.ai/harrison-chase/langchain_callback_demo</a>\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},"View run at <a href='https://wandb.ai/harrison-chase/langchain_callback_demo/runs/e47j1914' target=\"_blank\">https://wandb.ai/harrison-chase/langchain_callback_demo/runs/e47j1914</a>\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"\x1b[34m\x1b[1mwandb\x1b[0m: \x1b[33mWARNING\x1b[0m The wandb callback is currently in beta and is subject to change based on updates to `langchain`. Please report any issues to https://github.com/wandb/wandb/issues with the tag `langchain`.\n"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"# Defaults for WandbCallbackHandler.flush_tracker(...)\n\nreset: bool = True,\nfinish: bool = False,\n")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"flush_tracker")," function is used to log LangChain sessions to Weights & Biases. It takes in the LangChain module or agent, and logs at minimum the prompts and generations alongside the serialized form of the LangChain module to the specified Weights & Biases project. By default we reset the session as opposed to concluding the session outright."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'# SCENARIO 1 - LLM\nllm_result = llm.generate(["Tell me a joke", "Tell me a poem"] * 3)\nwandb_callback.flush_tracker(llm, name="simple_sequential")\n')),(0,r.kt)(p,{center:!0,mdxType:"HTMLOutputBlock"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},'Waiting for W&B process to finish... <strong style="color:green">(success).</strong>\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},'View run <strong style="color:#cdcd00">llm</strong> at: <a href=\'https://wandb.ai/harrison-chase/langchain_callback_demo/runs/e47j1914\' target="_blank">https://wandb.ai/harrison-chase/langchain_callback_demo/runs/e47j1914</a><br/>Synced 5 W&B file(s), 2 media file(s), 5 artifact file(s) and 0 other file(s)\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},"Find logs at: <code>./wandb/run-20230318_150408-e47j1914/logs</code>\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"VBox(children=(Label(value='Waiting for wandb.init()...\\r'), FloatProgress(value=0.016745895149999985, max=1.0\u2026\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},"Tracking run with wandb version 0.14.0\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},"Run data is saved locally in <code>/Users/harrisonchase/workplace/langchain/docs/ecosystem/wandb/run-20230318_150534-jyxma7hu</code>\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},"Syncing run <strong><a href='https://wandb.ai/harrison-chase/langchain_callback_demo/runs/jyxma7hu' target=\"_blank\">simple_sequential</a></strong> to <a href='https://wandb.ai/harrison-chase/langchain_callback_demo' target=\"_blank\">Weights & Biases</a> (<a href='https://wandb.me/run' target=\"_blank\">docs</a>)<br/>\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},"View project at <a href='https://wandb.ai/harrison-chase/langchain_callback_demo' target=\"_blank\">https://wandb.ai/harrison-chase/langchain_callback_demo</a>\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},"View run at <a href='https://wandb.ai/harrison-chase/langchain_callback_demo/runs/jyxma7hu' target=\"_blank\">https://wandb.ai/harrison-chase/langchain_callback_demo/runs/jyxma7hu</a>\n"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'\x3c!--IMPORTS:[{"imported": "PromptTemplate", "source": "langchain.prompts", "docs": "https://api.python.langchain.com/en/latest/prompts/langchain.prompts.prompt.PromptTemplate.html", "title": "Weights & Biases"}, {"imported": "LLMChain", "source": "langchain.chains", "docs": "https://api.python.langchain.com/en/latest/chains/langchain.chains.llm.LLMChain.html", "title": "Weights & Biases"}]--\x3e\nfrom langchain.prompts import PromptTemplate\nfrom langchain.chains import LLMChain\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'# SCENARIO 2 - Chain\ntemplate = """You are a playwright. Given the title of play, it is your job to write a synopsis for that title.\nTitle: {title}\nPlaywright: This is a synopsis for the above play:"""\nprompt_template = PromptTemplate(input_variables=["title"], template=template)\nsynopsis_chain = LLMChain(llm=llm, prompt=prompt_template, callbacks=callbacks)\n\ntest_prompts = [\n    {\n        "title": "documentary about good video games that push the boundary of game design"\n    },\n    {"title": "cocaine bear vs heroin wolf"},\n    {"title": "the best in class mlops tooling"},\n]\nsynopsis_chain.apply(test_prompts)\nwandb_callback.flush_tracker(synopsis_chain, name="agent")\n')),(0,r.kt)(p,{center:!0,mdxType:"HTMLOutputBlock"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},'Waiting for W&B process to finish... <strong style="color:green">(success).</strong>\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},'View run <strong style="color:#cdcd00">simple_sequential</strong> at: <a href=\'https://wandb.ai/harrison-chase/langchain_callback_demo/runs/jyxma7hu\' target="_blank">https://wandb.ai/harrison-chase/langchain_callback_demo/runs/jyxma7hu</a><br/>Synced 4 W&B file(s), 2 media file(s), 6 artifact file(s) and 0 other file(s)\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},"Find logs at: <code>./wandb/run-20230318_150534-jyxma7hu/logs</code>\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"VBox(children=(Label(value='Waiting for wandb.init()...\\r'), FloatProgress(value=0.016736786816666675, max=1.0\u2026\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},"Tracking run with wandb version 0.14.0\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},"Run data is saved locally in <code>/Users/harrisonchase/workplace/langchain/docs/ecosystem/wandb/run-20230318_150550-wzy59zjq</code>\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},"Syncing run <strong><a href='https://wandb.ai/harrison-chase/langchain_callback_demo/runs/wzy59zjq' target=\"_blank\">agent</a></strong> to <a href='https://wandb.ai/harrison-chase/langchain_callback_demo' target=\"_blank\">Weights & Biases</a> (<a href='https://wandb.me/run' target=\"_blank\">docs</a>)<br/>\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},"View project at <a href='https://wandb.ai/harrison-chase/langchain_callback_demo' target=\"_blank\">https://wandb.ai/harrison-chase/langchain_callback_demo</a>\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},"View run at <a href='https://wandb.ai/harrison-chase/langchain_callback_demo/runs/wzy59zjq' target=\"_blank\">https://wandb.ai/harrison-chase/langchain_callback_demo/runs/wzy59zjq</a>\n"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'\x3c!--IMPORTS:[{"imported": "initialize_agent", "source": "langchain.agents", "docs": "https://api.python.langchain.com/en/latest/agents/langchain.agents.initialize.initialize_agent.html", "title": "Weights & Biases"}, {"imported": "load_tools", "source": "langchain.agents", "docs": "https://api.python.langchain.com/en/latest/agents/langchain.agents.load_tools.load_tools.html", "title": "Weights & Biases"}, {"imported": "AgentType", "source": "langchain.agents", "docs": "https://api.python.langchain.com/en/latest/agents/langchain.agents.agent_types.AgentType.html", "title": "Weights & Biases"}]--\x3e\nfrom langchain.agents import initialize_agent, load_tools\nfrom langchain.agents import AgentType\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'# SCENARIO 3 - Agent with Tools\ntools = load_tools(["serpapi", "llm-math"], llm=llm)\nagent = initialize_agent(\n    tools,\n    llm,\n    agent=AgentType.ZERO_SHOT_REACT_DESCRIPTION,\n)\nagent.run(\n    "Who is Leo DiCaprio\'s girlfriend? What is her current age raised to the 0.43 power?",\n    callbacks=callbacks,\n)\nwandb_callback.flush_tracker(agent, reset=False, finish=True)\n')),(0,r.kt)(p,{center:!0,mdxType:"HTMLOutputBlock"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"> Entering new AgentExecutor chain...\n I need to find out who Leo DiCaprio's girlfriend is and then calculate her age raised to the 0.43 power.\nAction: Search\nAction Input: \"Leo DiCaprio girlfriend\"\nObservation: DiCaprio had a steady girlfriend in Camila Morrone. He had been with the model turned actress for nearly five years, as they were first said to be dating at the end of 2017. And the now 26-year-old Morrone is no stranger to Hollywood.\nThought: I need to calculate her age raised to the 0.43 power.\nAction: Calculator\nAction Input: 26^0.43\nObservation: Answer: 4.059182145592686\n\nThought: I now know the final answer.\nFinal Answer: Leo DiCaprio's girlfriend is Camila Morrone and her current age raised to the 0.43 power is 4.059182145592686.\n\n> Finished chain.\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},'Waiting for W&B process to finish... <strong style="color:green">(success).</strong>\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},'View run <strong style="color:#cdcd00">agent</strong> at: <a href=\'https://wandb.ai/harrison-chase/langchain_callback_demo/runs/wzy59zjq\' target="_blank">https://wandb.ai/harrison-chase/langchain_callback_demo/runs/wzy59zjq</a><br/>Synced 5 W&B file(s), 2 media file(s), 7 artifact file(s) and 0 other file(s)\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},"Find logs at: <code>./wandb/run-20230318_150550-wzy59zjq/logs</code>\n"))))}m.isMDXComponent=!0}}]);