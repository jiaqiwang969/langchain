"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[91222],{3905:(e,n,t)=>{t.d(n,{Zo:()=>l,kt:()=>g});var a=t(67294);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function d(e,n){if(null==e)return{};var t,a,o=function(e,n){if(null==e)return{};var t,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var p=a.createContext({}),c=function(e){var n=a.useContext(p),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},l=function(e){var n=c(e.components);return a.createElement(p.Provider,{value:n},e.children)},s="mdxType",m={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},u=a.forwardRef((function(e,n){var t=e.components,o=e.mdxType,r=e.originalType,p=e.parentName,l=d(e,["components","mdxType","originalType","parentName"]),s=c(t),u=o,g=s["".concat(p,".").concat(u)]||s[u]||m[u]||r;return t?a.createElement(g,i(i({ref:n},l),{},{components:t})):a.createElement(g,i({ref:n},l))}));function g(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var r=t.length,i=new Array(r);i[0]=u;var d={};for(var p in n)hasOwnProperty.call(n,p)&&(d[p]=n[p]);d.originalType=e,d[s]="string"==typeof e?e:o,i[1]=d;for(var c=2;c<r;c++)i[c]=t[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,t)}u.displayName="MDXCreateElement"},96225:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>p,contentTitle:()=>i,default:()=>g,frontMatter:()=>r,metadata:()=>d,toc:()=>c});var a=t(87462),o=(t(67294),t(3905));const r={},i="Geopandas",d={unversionedId:"integrations/document_loaders/geopandas",id:"integrations/document_loaders/geopandas",title:"Geopandas",description:"Geopandas is an open source project to make working with geospatial data in python easier.",source:"@site/docs/integrations/document_loaders/geopandas.md",sourceDirName:"integrations/document_loaders",slug:"/integrations/document_loaders/geopandas",permalink:"/langchain/docs/integrations/document_loaders/geopandas",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"integrations",previous:{title:"Figma",permalink:"/langchain/docs/integrations/document_loaders/figma"},next:{title:"Git",permalink:"/langchain/docs/integrations/document_loaders/git"}},p={},c=[],l=(s="CodeOutputBlock",function(e){return console.warn("Component "+s+" was not imported, exported, or provided by MDXProvider as global scope"),(0,o.kt)("div",e)});var s;const m={toc:c},u="wrapper";function g(e){let{components:n,...t}=e;return(0,o.kt)(u,(0,a.Z)({},m,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"geopandas"},"Geopandas"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://geopandas.org/en/stable/index.html"},"Geopandas")," is an open source project to make working with geospatial data in python easier. "),(0,o.kt)("p",null,"GeoPandas extends the datatypes used by pandas to allow spatial operations on geometric types. "),(0,o.kt)("p",null,"Geometric operations are performed by shapely. Geopandas further depends on fiona for file access and matplotlib for plotting."),(0,o.kt)("p",null,"LLM applications (chat, QA) that utilize geospatial data are an interesting area for exploration."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"pip install sodapy\n pip install pandas\n pip install geopandas\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'\x3c!--IMPORTS:[{"imported": "OpenCityDataLoader", "source": "langchain.document_loaders", "docs": "https://api.python.langchain.com/en/latest/document_loaders/langchain.document_loaders.open_city_data.OpenCityDataLoader.html", "title": "Geopandas"}]--\x3e\nimport ast\nimport pandas as pd\nimport geopandas as gpd\nfrom langchain.document_loaders import OpenCityDataLoader\n')),(0,o.kt)("p",null,"Create a GeoPandas dataframe from ",(0,o.kt)("a",{parentName:"p",href:"https://python.langchain.com/docs/integrations/document_loaders/open_city_data"},(0,o.kt)("inlineCode",{parentName:"a"},"Open City Data"))," as an example input."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'# Load Open City Data\ndataset = "tmnf-yvry"  # San Francisco crime data\nloader = OpenCityDataLoader(city_id="data.sfgov.org", dataset_id=dataset, limit=5000)\ndocs = loader.load()\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'# Convert list of dictionaries to DataFrame\ndf = pd.DataFrame([ast.literal_eval(d.page_content) for d in docs])\n\n# Extract latitude and longitude\ndf["Latitude"] = df["location"].apply(lambda loc: loc["coordinates"][1])\ndf["Longitude"] = df["location"].apply(lambda loc: loc["coordinates"][0])\n\n# Create geopandas DF\ngdf = gpd.GeoDataFrame(\n    df, geometry=gpd.points_from_xy(df.Longitude, df.Latitude), crs="EPSG:4326"\n)\n\n# Only keep valid longitudes and latitudes for San Francisco\ngdf = gdf[\n    (gdf["Longitude"] >= -123.173825)\n    & (gdf["Longitude"] <= -122.281780)\n    & (gdf["Latitude"] >= 37.623983)\n    & (gdf["Latitude"] <= 37.929824)\n]\n')),(0,o.kt)("p",null,"Visiualization of the sample of SF crimne data. "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'import matplotlib.pyplot as plt\n\n# Load San Francisco map data\nsf = gpd.read_file("https://data.sfgov.org/resource/3psu-pn9h.geojson")\n\n# Plot the San Francisco map and the points\nfig, ax = plt.subplots(figsize=(10, 10))\nsf.plot(ax=ax, color="white", edgecolor="black")\ngdf.plot(ax=ax, color="red", markersize=5)\nplt.show()\n')),(0,o.kt)("p",null,"Load GeoPandas dataframe as a ",(0,o.kt)("inlineCode",{parentName:"p"},"Document")," for downstream processing (embedding, chat, etc). "),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"geometry")," will be the default ",(0,o.kt)("inlineCode",{parentName:"p"},"page_content")," columns, and all other columns are placed in ",(0,o.kt)("inlineCode",{parentName:"p"},"metadata"),"."),(0,o.kt)("p",null,"But, we can specify the ",(0,o.kt)("inlineCode",{parentName:"p"},"page_content_column"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'\x3c!--IMPORTS:[{"imported": "GeoDataFrameLoader", "source": "langchain.document_loaders", "docs": "https://api.python.langchain.com/en/latest/document_loaders/langchain.document_loaders.geodataframe.GeoDataFrameLoader.html", "title": "Geopandas"}]--\x3e\nfrom langchain.document_loaders import GeoDataFrameLoader\n\nloader = GeoDataFrameLoader(data_frame=gdf, page_content_column="geometry")\ndocs = loader.load()\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},"docs[0]\n")),(0,o.kt)(l,{lang:"python",mdxType:"CodeOutputBlock"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"    Document(page_content='POINT (-122.420084075249 37.7083109744362)', metadata={'pdid': '4133422003074', 'incidntnum': '041334220', 'incident_code': '03074', 'category': 'ROBBERY', 'descript': 'ROBBERY, BODILY FORCE', 'dayofweek': 'Monday', 'date': '2004-11-22T00:00:00.000', 'time': '17:50', 'pddistrict': 'INGLESIDE', 'resolution': 'NONE', 'address': 'GENEVA AV / SANTOS ST', 'x': '-122.420084075249', 'y': '37.7083109744362', 'location': {'type': 'Point', 'coordinates': [-122.420084075249, 37.7083109744362]}, ':@computed_region_26cr_cadq': '9', ':@computed_region_rxqg_mtj9': '8', ':@computed_region_bh8s_q3mv': '309', ':@computed_region_6qbp_sg9q': nan, ':@computed_region_qgnn_b9vv': nan, ':@computed_region_ajp5_b2md': nan, ':@computed_region_yftq_j783': nan, ':@computed_region_p5aj_wyqh': nan, ':@computed_region_fyvs_ahh9': nan, ':@computed_region_6pnf_4xz7': nan, ':@computed_region_jwn9_ihcz': nan, ':@computed_region_9dfj_4gjx': nan, ':@computed_region_4isq_27mq': nan, ':@computed_region_pigm_ib2e': nan, ':@computed_region_9jxd_iqea': nan, ':@computed_region_6ezc_tdp2': nan, ':@computed_region_h4ep_8xdi': nan, ':@computed_region_n4xg_c4py': nan, ':@computed_region_fcz8_est8': nan, ':@computed_region_nqbw_i6c3': nan, ':@computed_region_2dwj_jsy4': nan, 'Latitude': 37.7083109744362, 'Longitude': -122.420084075249})\n"))))}g.isMDXComponent=!0}}]);