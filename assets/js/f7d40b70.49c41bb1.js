"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[5167],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>m});var r=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=r.createContext({}),c=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=c(e.components);return r.createElement(l.Provider,{value:t},e.children)},p="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),p=c(n),d=a,m=p["".concat(l,".").concat(d)]||p[d]||h[d]||o;return n?r.createElement(m,i(i({ref:t},u),{},{components:n})):r.createElement(m,i({ref:t},u))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[p]="string"==typeof e?e:a,i[1]=s;for(var c=2;c<o;c++)i[c]=n[c];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},29873:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>p,default:()=>f,frontMatter:()=>u,metadata:()=>h,toc:()=>m});var r=n(87462),a=(n(67294),n(3905));const o=(i="CodeOutputBlock",function(e){return console.warn("Component "+i+" was not imported, exported, or provided by MDXProvider as global scope"),(0,a.kt)("div",e)});var i;const s={toc:[]},l="wrapper";function c(e){let{components:t,...n}=e;return(0,a.kt)(l,(0,r.Z)({},s,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-python"},"from langchain.chains.router import MultiRetrievalQAChain\nfrom langchain.llms import OpenAI\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-python"},'from langchain.embeddings import OpenAIEmbeddings\nfrom langchain.document_loaders import TextLoader\nfrom langchain.vectorstores import FAISS\n\nsou_docs = TextLoader(\'../../state_of_the_union.txt\').load_and_split()\nsou_retriever = FAISS.from_documents(sou_docs, OpenAIEmbeddings()).as_retriever()\n\npg_docs = TextLoader(\'../../paul_graham_essay.txt\').load_and_split()\npg_retriever = FAISS.from_documents(pg_docs, OpenAIEmbeddings()).as_retriever()\n\npersonal_texts = [\n    "I love apple pie",\n    "My favorite color is fuchsia",\n    "My dream is to become a professional dancer",\n    "I broke my arm when I was 12",\n    "My parents are from Peru",\n]\npersonal_retriever = FAISS.from_texts(personal_texts, OpenAIEmbeddings()).as_retriever()\n')),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-python"},'retriever_infos = [\n    {\n        "name": "state of the union", \n        "description": "Good for answering questions about the 2023 State of the Union address", \n        "retriever": sou_retriever\n    },\n    {\n        "name": "pg essay", \n        "description": "Good for answering questions about Paul Graham\'s essay on his career",\n        "retriever": pg_retriever\n    },\n    {\n        "name": "personal", \n        "description": "Good for answering questions about me", \n        "retriever": personal_retriever\n    }\n]\n')),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-python"},"chain = MultiRetrievalQAChain.from_retrievers(OpenAI(), retriever_infos, verbose=True)\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-python"},'print(chain.run("What did the president say about the economy?"))\n')),(0,a.kt)(o,{lang:"python",mdxType:"CodeOutputBlock"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"    \n    \n    > Entering new MultiRetrievalQAChain chain...\n    state of the union: {'query': 'What did the president say about the economy in the 2023 State of the Union address?'}\n    > Finished chain.\n     The president said that the economy was stronger than it had been a year prior, and that the American Rescue Plan helped create record job growth and fuel economic relief for millions of Americans. He also proposed a plan to fight inflation and lower costs for families, including cutting the cost of prescription drugs and energy, providing investments and tax credits for energy efficiency, and increasing access to child care and Pre-K.\n"))),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-python"},'print(chain.run("What is something Paul Graham regrets about his work?"))\n')),(0,a.kt)(o,{lang:"python",mdxType:"CodeOutputBlock"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"    \n    \n    > Entering new MultiRetrievalQAChain chain...\n    pg essay: {'query': 'What is something Paul Graham regrets about his work?'}\n    > Finished chain.\n     Paul Graham regrets that he did not take a vacation after selling his company, instead of immediately starting to paint.\n"))),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-python"},'print(chain.run("What is my background?"))\n')),(0,a.kt)(o,{lang:"python",mdxType:"CodeOutputBlock"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"    \n    \n    > Entering new MultiRetrievalQAChain chain...\n    personal: {'query': 'What is my background?'}\n    > Finished chain.\n     Your background is Peruvian.\n"))),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-python"},'print(chain.run("What year was the Internet created in?"))\n')),(0,a.kt)(o,{lang:"python",mdxType:"CodeOutputBlock"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"    \n    \n    > Entering new MultiRetrievalQAChain chain...\n    None: {'query': 'What year was the Internet created in?'}\n    > Finished chain.\n    The Internet was created in 1969 through a project called ARPANET, which was funded by the United States Department of Defense. However, the World Wide Web, which is often confused with the Internet, was created in 1989 by British computer scientist Tim Berners-Lee.\n"))))}c.isMDXComponent=!0;const u={},p="Dynamically select from multiple retrievers",h={unversionedId:"use_cases/question_answering/how_to/multi_retrieval_qa_router",id:"use_cases/question_answering/how_to/multi_retrieval_qa_router",title:"Dynamically select from multiple retrievers",description:"This notebook demonstrates how to use the RouterChain paradigm to create a chain that dynamically selects which Retrieval system to use. Specifically we show how to use the MultiRetrievalQAChain to create a question-answering chain that selects the retrieval QA chain which is most relevant for a given question, and then answers the question using it.",source:"@site/docs/use_cases/question_answering/how_to/multi_retrieval_qa_router.mdx",sourceDirName:"use_cases/question_answering/how_to",slug:"/use_cases/question_answering/how_to/multi_retrieval_qa_router",permalink:"/langchain/docs/use_cases/question_answering/how_to/multi_retrieval_qa_router",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"use_cases",previous:{title:"Use local LLMs",permalink:"/langchain/docs/use_cases/question_answering/how_to/local_retrieval_qa"},next:{title:"Multiple Retrieval Sources",permalink:"/langchain/docs/use_cases/question_answering/how_to/multiple_retrieval"}},d={},m=[],g={toc:m},y="wrapper";function f(e){let{components:t,...n}=e;return(0,a.kt)(y,(0,r.Z)({},g,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"dynamically-select-from-multiple-retrievers"},"Dynamically select from multiple retrievers"),(0,a.kt)("p",null,"This notebook demonstrates how to use the ",(0,a.kt)("inlineCode",{parentName:"p"},"RouterChain")," paradigm to create a chain that dynamically selects which Retrieval system to use. Specifically we show how to use the ",(0,a.kt)("inlineCode",{parentName:"p"},"MultiRetrievalQAChain")," to create a question-answering chain that selects the retrieval QA chain which is most relevant for a given question, and then answers the question using it."),(0,a.kt)(c,{mdxType:"Example"}))}f.isMDXComponent=!0}}]);