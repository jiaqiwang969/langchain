"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[61308],{3905:(e,t,n)=>{n.d(t,{Zo:()=>h,kt:()=>g});var a=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=a.createContext({}),i=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):p(p({},t),e)),n},h=function(e){var t=i(e.components);return a.createElement(l.Provider,{value:t},e.children)},c="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},w=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,l=e.parentName,h=s(e,["components","mdxType","originalType","parentName"]),c=i(n),w=o,g=c["".concat(l,".").concat(w)]||c[w]||m[w]||r;return n?a.createElement(g,p(p({ref:t},h),{},{components:n})):a.createElement(g,p({ref:t},h))}));function g(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,p=new Array(r);p[0]=w;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[c]="string"==typeof e?e:o,p[1]=s;for(var i=2;i<r;i++)p[i]=n[i];return a.createElement.apply(null,p)}return a.createElement.apply(null,n)}w.displayName="MDXCreateElement"},73145:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>p,default:()=>g,frontMatter:()=>r,metadata:()=>s,toc:()=>i});var a=n(87462),o=(n(67294),n(3905));const r={},p="GraphSparqlQAChain",s={unversionedId:"use_cases/more/graph/graph_sparql_qa",id:"use_cases/more/graph/graph_sparql_qa",title:"GraphSparqlQAChain",description:"Graph databases are an excellent choice for applications based on network-like models. To standardize the syntax and semantics of such graphs, the W3C recommends Semantic Web Technologies, cp. Semantic Web. SPARQL serves as a query language analogously to SQL or Cypher for these graphs. This notebook demonstrates the application of LLMs as a natural language interface to a graph database by generating SPARQL.\\",source:"@site/docs/use_cases/more/graph/graph_sparql_qa.md",sourceDirName:"use_cases/more/graph",slug:"/use_cases/more/graph/graph_sparql_qa",permalink:"/langchain/docs/use_cases/more/graph/graph_sparql_qa",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"use_cases",previous:{title:"Graph QA",permalink:"/langchain/docs/use_cases/more/graph/graph_qa"},next:{title:"Neptune Open Cypher QA Chain",permalink:"/langchain/docs/use_cases/more/graph/neptune_cypher_qa"}},l={},i=[{value:"Refresh graph schema information",id:"refresh-graph-schema-information",level:2},{value:"Querying the graph",id:"querying-the-graph",level:2},{value:"Updating the graph",id:"updating-the-graph",level:2}],h=(c="CodeOutputBlock",function(e){return console.warn("Component "+c+" was not imported, exported, or provided by MDXProvider as global scope"),(0,o.kt)("div",e)});var c;const m={toc:i},w="wrapper";function g(e){let{components:t,...n}=e;return(0,o.kt)(w,(0,a.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"graphsparqlqachain"},"GraphSparqlQAChain"),(0,o.kt)("p",null,"Graph databases are an excellent choice for applications based on network-like models. To standardize the syntax and semantics of such graphs, the W3C recommends Semantic Web Technologies, cp. ",(0,o.kt)("a",{parentName:"p",href:"https://www.w3.org/standards/semanticweb/"},"Semantic Web"),". ",(0,o.kt)("a",{parentName:"p",href:"https://www.w3.org/TR/sparql11-query/"},"SPARQL")," serves as a query language analogously to SQL or Cypher for these graphs. This notebook demonstrates the application of LLMs as a natural language interface to a graph database by generating SPARQL.\\\nDisclaimer: To date, SPARQL query generation via LLMs is still a bit unstable. Be especially careful with UPDATE queries, which alter the graph."),(0,o.kt)("p",null,"There are several sources you can run queries against, including files on the web, files you have available locally, SPARQL endpoints, e.g., ",(0,o.kt)("a",{parentName:"p",href:"https://www.wikidata.org/wiki/Wikidata:Main_Page"},"Wikidata"),", and ",(0,o.kt)("a",{parentName:"p",href:"https://www.w3.org/wiki/LargeTripleStores"},"triple stores"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'\x3c!--IMPORTS:[{"imported": "ChatOpenAI", "source": "langchain.chat_models", "docs": "https://api.python.langchain.com/en/latest/chat_models/langchain.chat_models.openai.ChatOpenAI.html", "title": "GraphSparqlQAChain"}, {"imported": "GraphSparqlQAChain", "source": "langchain.chains", "docs": "https://api.python.langchain.com/en/latest/chains/langchain.chains.graph_qa.sparql.GraphSparqlQAChain.html", "title": "GraphSparqlQAChain"}, {"imported": "RdfGraph", "source": "langchain.graphs", "docs": "https://api.python.langchain.com/en/latest/graphs/langchain.graphs.rdf_graph.RdfGraph.html", "title": "GraphSparqlQAChain"}]--\x3e\nfrom langchain.chat_models import ChatOpenAI\nfrom langchain.chains import GraphSparqlQAChain\nfrom langchain.graphs import RdfGraph\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'graph = RdfGraph(\n    source_file="http://www.w3.org/People/Berners-Lee/card",\n    standard="rdf",\n    local_copy="test.ttl",\n)\n')),(0,o.kt)("p",null,"Note that providing a ",(0,o.kt)("inlineCode",{parentName:"p"},"local_file")," is necessary for storing changes locally if the source is read-only."),(0,o.kt)("h2",{id:"refresh-graph-schema-information"},"Refresh graph schema information"),(0,o.kt)("p",null,"If the schema of the database changes, you can refresh the schema information needed to generate SPARQL queries."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},"graph.load_schema()\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},"graph.get_schema\n")),(0,o.kt)(h,{lang:"python",mdxType:"CodeOutputBlock"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"    In the following, each IRI is followed by the local name and optionally its description in parentheses. \n    The RDF graph supports the following node types:\n    <http://xmlns.com/foaf/0.1/PersonalProfileDocument> (PersonalProfileDocument, None), <http://www.w3.org/ns/auth/cert#RSAPublicKey> (RSAPublicKey, None), <http://www.w3.org/2000/10/swap/pim/contact#Male> (Male, None), <http://xmlns.com/foaf/0.1/Person> (Person, None), <http://www.w3.org/2006/vcard/ns#Work> (Work, None)\n    The RDF graph supports the following relationships:\n    <http://www.w3.org/2000/01/rdf-schema#seeAlso> (seeAlso, None), <http://purl.org/dc/elements/1.1/title> (title, None), <http://xmlns.com/foaf/0.1/mbox_sha1sum> (mbox_sha1sum, None), <http://xmlns.com/foaf/0.1/maker> (maker, None), <http://www.w3.org/ns/solid/terms#oidcIssuer> (oidcIssuer, None), <http://www.w3.org/2000/10/swap/pim/contact#publicHomePage> (publicHomePage, None), <http://xmlns.com/foaf/0.1/openid> (openid, None), <http://www.w3.org/ns/pim/space#storage> (storage, None), <http://xmlns.com/foaf/0.1/name> (name, None), <http://www.w3.org/2000/10/swap/pim/contact#country> (country, None), <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> (type, None), <http://www.w3.org/ns/solid/terms#profileHighlightColor> (profileHighlightColor, None), <http://www.w3.org/ns/pim/space#preferencesFile> (preferencesFile, None), <http://www.w3.org/2000/01/rdf-schema#label> (label, None), <http://www.w3.org/ns/auth/cert#modulus> (modulus, None), <http://www.w3.org/2000/10/swap/pim/contact#participant> (participant, None), <http://www.w3.org/2000/10/swap/pim/contact#street2> (street2, None), <http://www.w3.org/2006/vcard/ns#locality> (locality, None), <http://xmlns.com/foaf/0.1/nick> (nick, None), <http://xmlns.com/foaf/0.1/homepage> (homepage, None), <http://creativecommons.org/ns#license> (license, None), <http://xmlns.com/foaf/0.1/givenname> (givenname, None), <http://www.w3.org/2006/vcard/ns#street-address> (street-address, None), <http://www.w3.org/2006/vcard/ns#postal-code> (postal-code, None), <http://www.w3.org/2000/10/swap/pim/contact#street> (street, None), <http://www.w3.org/2003/01/geo/wgs84_pos#lat> (lat, None), <http://xmlns.com/foaf/0.1/primaryTopic> (primaryTopic, None), <http://www.w3.org/2006/vcard/ns#fn> (fn, None), <http://www.w3.org/2003/01/geo/wgs84_pos#location> (location, None), <http://usefulinc.com/ns/doap#developer> (developer, None), <http://www.w3.org/2000/10/swap/pim/contact#city> (city, None), <http://www.w3.org/2006/vcard/ns#region> (region, None), <http://xmlns.com/foaf/0.1/member> (member, None), <http://www.w3.org/2003/01/geo/wgs84_pos#long> (long, None), <http://www.w3.org/2000/10/swap/pim/contact#address> (address, None), <http://xmlns.com/foaf/0.1/family_name> (family_name, None), <http://xmlns.com/foaf/0.1/account> (account, None), <http://xmlns.com/foaf/0.1/workplaceHomepage> (workplaceHomepage, None), <http://purl.org/dc/terms/title> (title, None), <http://www.w3.org/ns/solid/terms#publicTypeIndex> (publicTypeIndex, None), <http://www.w3.org/2000/10/swap/pim/contact#office> (office, None), <http://www.w3.org/2000/10/swap/pim/contact#homePage> (homePage, None), <http://xmlns.com/foaf/0.1/mbox> (mbox, None), <http://www.w3.org/2000/10/swap/pim/contact#preferredURI> (preferredURI, None), <http://www.w3.org/ns/solid/terms#profileBackgroundColor> (profileBackgroundColor, None), <http://schema.org/owns> (owns, None), <http://xmlns.com/foaf/0.1/based_near> (based_near, None), <http://www.w3.org/2006/vcard/ns#hasAddress> (hasAddress, None), <http://xmlns.com/foaf/0.1/img> (img, None), <http://www.w3.org/2000/10/swap/pim/contact#assistant> (assistant, None), <http://xmlns.com/foaf/0.1/title> (title, None), <http://www.w3.org/ns/auth/cert#key> (key, None), <http://www.w3.org/ns/ldp#inbox> (inbox, None), <http://www.w3.org/ns/solid/terms#editableProfile> (editableProfile, None), <http://www.w3.org/2000/10/swap/pim/contact#postalCode> (postalCode, None), <http://xmlns.com/foaf/0.1/weblog> (weblog, None), <http://www.w3.org/ns/auth/cert#exponent> (exponent, None), <http://rdfs.org/sioc/ns#avatar> (avatar, None)\n    \n"))),(0,o.kt)("h2",{id:"querying-the-graph"},"Querying the graph"),(0,o.kt)("p",null,"Now, you can use the graph SPARQL QA chain to ask questions about the graph."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},"chain = GraphSparqlQAChain.from_llm(\n    ChatOpenAI(temperature=0), graph=graph, verbose=True\n)\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'chain.run("What is Tim Berners-Lee\'s work homepage?")\n')),(0,o.kt)(h,{lang:"python",mdxType:"CodeOutputBlock"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'    \n    \n    > Entering new GraphSparqlQAChain chain...\n    Identified intent:\n    SELECT\n    Generated SPARQL:\n    PREFIX foaf: <http://xmlns.com/foaf/0.1/>\n    SELECT ?homepage\n    WHERE {\n        ?person foaf:name "Tim Berners-Lee" .\n        ?person foaf:workplaceHomepage ?homepage .\n    }\n    Full Context:\n    []\n    \n    > Finished chain.\n\n\n\n\n\n    "Tim Berners-Lee\'s work homepage is http://www.w3.org/People/Berners-Lee/."\n'))),(0,o.kt)("h2",{id:"updating-the-graph"},"Updating the graph"),(0,o.kt)("p",null,"Analogously, you can update the graph, i.e., insert triples, using natural language."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},"chain.run(\n    \"Save that the person with the name 'Timothy Berners-Lee' has a work homepage at 'http://www.w3.org/foo/bar/'\"\n)\n")),(0,o.kt)(h,{lang:"python",mdxType:"CodeOutputBlock"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"    \n    \n    > Entering new GraphSparqlQAChain chain...\n    Identified intent:\n    UPDATE\n    Generated SPARQL:\n    PREFIX foaf: <http://xmlns.com/foaf/0.1/>\n    INSERT {\n        ?person foaf:workplaceHomepage <http://www.w3.org/foo/bar/> .\n    }\n    WHERE {\n        ?person foaf:name \"Timothy Berners-Lee\" .\n    }\n    \n    > Finished chain.\n\n\n\n\n\n    'Successfully inserted triples into the graph.'\n"))),(0,o.kt)("p",null,"Let's verify the results:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'query = (\n    """PREFIX foaf: <http://xmlns.com/foaf/0.1/>\\n"""\n    """SELECT ?hp\\n"""\n    """WHERE {\\n"""\n    """    ?person foaf:name "Timothy Berners-Lee" . \\n"""\n    """    ?person foaf:workplaceHomepage ?hp .\\n"""\n    """}"""\n)\ngraph.query(query)\n')),(0,o.kt)(h,{lang:"python",mdxType:"CodeOutputBlock"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"    [(rdflib.term.URIRef('https://www.w3.org/'),),\n     (rdflib.term.URIRef('http://www.w3.org/foo/bar/'),)]\n"))))}g.isMDXComponent=!0}}]);