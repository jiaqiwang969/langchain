"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[96145],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>h});var o=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},a=Object.keys(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var c=o.createContext({}),l=function(e){var t=o.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},d=function(e){var t=l(e.components);return o.createElement(c.Provider,{value:t},e.children)},p="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},m=o.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,c=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),p=l(n),m=r,h=p["".concat(c,".").concat(m)]||p[m]||u[m]||a;return n?o.createElement(h,i(i({ref:t},d),{},{components:n})):o.createElement(h,i({ref:t},d))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,i=new Array(a);i[0]=m;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s[p]="string"==typeof e?e:r,i[1]=s;for(var l=2;l<a;l++)i[l]=n[l];return o.createElement.apply(null,i)}return o.createElement.apply(null,n)}m.displayName="MDXCreateElement"},43384:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>u,frontMatter:()=>a,metadata:()=>s,toc:()=>l});var o=n(87462),r=(n(67294),n(3905));const a={},i="Rockset",s={unversionedId:"integrations/vectorstores/rockset",id:"integrations/vectorstores/rockset",title:"Rockset",description:"Rockset is a real-time search and analytics database built for the cloud. Rockset uses a Converged Index\u2122 with an efficient store for vector embeddings to serve low latency, high concurrency search queries at scale. Rockset has full support for metadata filtering and  handles real-time ingestion for constantly updating, streaming data.",source:"@site/docs/integrations/vectorstores/rockset.md",sourceDirName:"integrations/vectorstores",slug:"/integrations/vectorstores/rockset",permalink:"/langchain/docs/integrations/vectorstores/rockset",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"integrations",previous:{title:"Redis",permalink:"/langchain/docs/integrations/vectorstores/redis"},next:{title:"ScaNN",permalink:"/langchain/docs/integrations/vectorstores/scann"}},c={},l=[{value:"Setting Up Your Environment",id:"setting-up-your-environment",level:2},{value:"LangChain Tutorial",id:"langchain-tutorial",level:2},{value:"1. Define Key Variables",id:"1-define-key-variables",level:3},{value:"2. Prepare Documents",id:"2-prepare-documents",level:3},{value:"3. Insert Documents",id:"3-insert-documents",level:3},{value:"4. Search for Similar Documents",id:"4-search-for-similar-documents",level:3},{value:"5. Search for Similar Documents with Filtering",id:"5-search-for-similar-documents-with-filtering",level:3},{value:"6.\xa0Optional\xa0Delete Inserted Documents",id:"6optionaldelete-inserted-documents",level:3},{value:"Summary",id:"summary",level:2}],d={toc:l},p="wrapper";function u(e){let{components:t,...n}=e;return(0,r.kt)(p,(0,o.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"rockset"},"Rockset"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("a",{parentName:"p",href:"https://rockset.com/"},"Rockset")," is a real-time search and analytics database built for the cloud. Rockset uses a ",(0,r.kt)("a",{parentName:"p",href:"https://rockset.com/blog/converged-indexing-the-secret-sauce-behind-rocksets-fast-queries/"},"Converged Index\u2122")," with an efficient store for vector embeddings to serve low latency, high concurrency search queries at scale. Rockset has full support for metadata filtering and  handles real-time ingestion for constantly updating, streaming data.")),(0,r.kt)("p",null,"This notebook demonstrates how to use\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"Rockset")," as a vector store in LangChain. Before getting started, make sure you have access to a ",(0,r.kt)("inlineCode",{parentName:"p"},"Rockset")," account and an API key available. ",(0,r.kt)("a",{parentName:"p",href:"https://rockset.com/create/"},"Start your free trial today.")),(0,r.kt)("h2",{id:"setting-up-your-environment"},"Setting Up Your Environment",(0,r.kt)("a",{parentName:"h2",href:"https://python.langchain.com/docs/modules/data_connection/vectorstores/integrations/rockset#setting-up-environment"})),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Leverage the ",(0,r.kt)("inlineCode",{parentName:"p"},"Rockset")," console to create a ",(0,r.kt)("a",{parentName:"p",href:"https://rockset.com/docs/collections/"},"collection")," with the Write API as your source. In this walkthrough, we create a collection named\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"langchain_demo"),". "),(0,r.kt)("p",{parentName:"li"},"Configure the following ",(0,r.kt)("a",{parentName:"p",href:"https://rockset.com/docs/ingest-transformation/"},"ingest transformation")," to mark your embeddings\xa0field and take advantage of performance and storage optimizations:"))),(0,r.kt)("p",null,"   (We used OpenAI ",(0,r.kt)("inlineCode",{parentName:"p"},"text-embedding-ada-002")," for this examples, where #length_of_vector_embedding = 1536)"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},"SELECT _input.* EXCEPT(_meta), \nVECTOR_ENFORCE(_input.description_embedding, #length_of_vector_embedding, 'float') as description_embedding \nFROM _input\n")),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"After creating your collection, use the console to retrieve an ",(0,r.kt)("a",{parentName:"p",href:"https://rockset.com/docs/iam/#users-api-keys-and-roles"},"API key"),". For the purpose of this notebook, we assume you are using the\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"Oregon(us-west-2)")," region.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Install the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/rockset/rockset-python-client"},"rockset-python-client")," to enable LangChain to communicate directly with ",(0,r.kt)("inlineCode",{parentName:"p"},"Rockset"),"."))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},"pip install rockset\n")),(0,r.kt)("h2",{id:"langchain-tutorial"},"LangChain Tutorial"),(0,r.kt)("p",null,"Follow along in your own Python notebook to generate and store vector embeddings in Rockset.\nStart using Rockset to search for documents similar to your search queries."),(0,r.kt)("h3",{id:"1-define-key-variables"},"1. Define Key Variables"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},"import os\nimport rockset\n\nROCKSET_API_KEY = os.environ.get(\"ROCKSET_API_KEY\") # Verify ROCKSET_API_KEY environment variable\nROCKSET_API_SERVER = rockset.Regions.usw2a1 # Verify Rockset region\nrockset_client = rockset.RocksetClient(ROCKSET_API_SERVER, ROCKSET_API_KEY)\n\nCOLLECTION_NAME='langchain_demo'\nTEXT_KEY='description'\nEMBEDDING_KEY='description_embedding'\n")),(0,r.kt)("h3",{id:"2-prepare-documents"},"2. Prepare Documents"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'\x3c!--IMPORTS:[{"imported": "OpenAIEmbeddings", "source": "langchain.embeddings.openai", "docs": "https://api.python.langchain.com/en/latest/embeddings/langchain.embeddings.openai.OpenAIEmbeddings.html", "title": "Rockset"}, {"imported": "CharacterTextSplitter", "source": "langchain.text_splitter", "docs": "https://api.python.langchain.com/en/latest/text_splitter/langchain.text_splitter.CharacterTextSplitter.html", "title": "Rockset"}, {"imported": "TextLoader", "source": "langchain.document_loaders", "docs": "https://api.python.langchain.com/en/latest/document_loaders/langchain.document_loaders.text.TextLoader.html", "title": "Rockset"}, {"imported": "Rockset", "source": "langchain.vectorstores", "docs": "https://api.python.langchain.com/en/latest/vectorstores/langchain.vectorstores.rocksetdb.Rockset.html", "title": "Rockset"}]--\x3e\nfrom langchain.embeddings.openai import OpenAIEmbeddings\nfrom langchain.text_splitter import CharacterTextSplitter\nfrom langchain.document_loaders import TextLoader\nfrom langchain.vectorstores import Rockset\n\nloader = TextLoader(\'../../../state_of_the_union.txt\')\ndocuments = loader.load()\ntext_splitter = CharacterTextSplitter(chunk_size=1000, chunk_overlap=0)\ndocs = text_splitter.split_documents(documents)\n')),(0,r.kt)("h3",{id:"3-insert-documents"},"3. Insert Documents"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},"embeddings = OpenAIEmbeddings() # Verify OPENAI_API_KEY environment variable\n\ndocsearch = Rockset(\n    client=rockset_client,\n    embeddings=embeddings,\n    collection_name=COLLECTION_NAME,\n    text_key=TEXT_KEY,\n    embedding_key=EMBEDDING_KEY,\n)\n\nids=docsearch.add_texts(\n    texts=[d.page_content for d in docs],\n    metadatas=[d.metadata for d in docs],\n)\n")),(0,r.kt)("h3",{id:"4-search-for-similar-documents"},"4. Search for Similar Documents"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},"query = \"What did the president say about Ketanji Brown Jackson\"\noutput = docsearch.similarity_search_with_relevance_scores(\n    query, 4, Rockset.DistanceFunction.COSINE_SIM\n)\nprint(\"output length:\", len(output))\nfor d, dist in output:\n    print(dist, d.metadata, d.page_content[:20] + '...')\n\n##\n# output length: 4\n# 0.764990692109871 {'source': '../../../state_of_the_union.txt'} Madam Speaker, Madam...\n# 0.7485416901622112 {'source': '../../../state_of_the_union.txt'} And I\u2019m taking robus...\n# 0.7468678973398306 {'source': '../../../state_of_the_union.txt'} And so many families...\n# 0.7436231261419488 {'source': '../../../state_of_the_union.txt'} Groups of citizens b...\n")),(0,r.kt)("h3",{id:"5-search-for-similar-documents-with-filtering"},"5. Search for Similar Documents with Filtering"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},"output = docsearch.similarity_search_with_relevance_scores(\n    query,\n    4,\n    Rockset.DistanceFunction.COSINE_SIM,\n    where_str=\"{} NOT LIKE '%citizens%'\".format(TEXT_KEY),\n)\nprint(\"output length:\", len(output))\nfor d, dist in output:\n    print(dist, d.metadata, d.page_content[:20] + '...')\n\n##\n# output length: 4\n# 0.7651359650263554 {'source': '../../../state_of_the_union.txt'} Madam Speaker, Madam...\n# 0.7486265516824893 {'source': '../../../state_of_the_union.txt'} And I\u2019m taking robus...\n# 0.7469625542348115 {'source': '../../../state_of_the_union.txt'} And so many families...\n# 0.7344177777547739 {'source': '../../../state_of_the_union.txt'} We see the unity amo...\n")),(0,r.kt)("h3",{id:"6optionaldelete-inserted-documents"},"6.\xa0","[Optional]","\xa0Delete Inserted Documents"),(0,r.kt)("p",null,"You must have the unique ID associated with each document to delete them from your collection.\nDefine IDs when inserting documents with ",(0,r.kt)("inlineCode",{parentName:"p"},"Rockset.add_texts()"),". Rockset will otherwise generate a unique ID for each document. Regardless, ",(0,r.kt)("inlineCode",{parentName:"p"},"Rockset.add_texts()")," returns the IDs of inserted documents."),(0,r.kt)("p",null,"To delete these docs, simply use the ",(0,r.kt)("inlineCode",{parentName:"p"},"Rockset.delete_texts()")," function."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},"docsearch.delete_texts(ids)\n")),(0,r.kt)("h2",{id:"summary"},"Summary"),(0,r.kt)("p",null,"In this tutorial, we successfully created a ",(0,r.kt)("inlineCode",{parentName:"p"},"Rockset")," collection, ",(0,r.kt)("inlineCode",{parentName:"p"},"inserted")," documents with  OpenAI embeddings, and searched for similar documents with and without metadata filters."),(0,r.kt)("p",null,"Keep an eye on\xa0",(0,r.kt)("a",{parentName:"p",href:"https://rockset.com/"},"https://rockset.com/")," for future updates in this space."))}u.isMDXComponent=!0}}]);