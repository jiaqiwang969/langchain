"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[78598],{3905:(e,t,r)=>{r.d(t,{Zo:()=>d,kt:()=>g});var n=r(67294);function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){i(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function l(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}var p=n.createContext({}),s=function(e){var t=n.useContext(p),r=t;return e&&(r="function"==typeof e?e(t):a(a({},t),e)),r},d=function(e){var t=s(e.components);return n.createElement(p.Provider,{value:t},e.children)},c="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var r=e.components,i=e.mdxType,o=e.originalType,p=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),c=s(r),m=i,g=c["".concat(p,".").concat(m)]||c[m]||u[m]||o;return r?n.createElement(g,a(a({ref:t},d),{},{components:r})):n.createElement(g,a({ref:t},d))}));function g(e,t){var r=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=r.length,a=new Array(o);a[0]=m;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l[c]="string"==typeof e?e:i,a[1]=l;for(var s=2;s<o;s++)a[s]=r[s];return n.createElement.apply(null,a)}return n.createElement.apply(null,r)}m.displayName="MDXCreateElement"},44818:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>p,contentTitle:()=>a,default:()=>u,frontMatter:()=>o,metadata:()=>l,toc:()=>s});var n=r(87462),i=(r(67294),r(3905));const o={},a="Google Drive Retriever",l={unversionedId:"integrations/retrievers/google_drive",id:"integrations/retrievers/google_drive",title:"Google Drive Retriever",description:"This notebook covers how to retrieve documents from Google Drive.",source:"@site/docs/integrations/retrievers/google_drive.md",sourceDirName:"integrations/retrievers",slug:"/integrations/retrievers/google_drive",permalink:"/langchain/docs/integrations/retrievers/google_drive",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"integrations",previous:{title:"Google Cloud Enterprise Search",permalink:"/langchain/docs/integrations/retrievers/google_cloud_enterprise_search"},next:{title:"kNN",permalink:"/langchain/docs/integrations/retrievers/knn"}},p={},s=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Instructions for retrieving your Google Docs data",id:"instructions-for-retrieving-your-google-docs-data",level:2}],d={toc:s},c="wrapper";function u(e){let{components:t,...r}=e;return(0,i.kt)(c,(0,n.Z)({},d,r,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"google-drive-retriever"},"Google Drive Retriever"),(0,i.kt)("p",null,"This notebook covers how to retrieve documents from Google Drive."),(0,i.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Create a Google Cloud project or use an existing project"),(0,i.kt)("li",{parentName:"ol"},"Enable the ",(0,i.kt)("a",{parentName:"li",href:"https://console.cloud.google.com/flows/enableapi?apiid=drive.googleapis.com"},"Google Drive API")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("a",{parentName:"li",href:"https://developers.google.com/drive/api/quickstart/python#authorize_credentials_for_a_desktop_application"},"Authorize credentials for desktop app")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"pip install --upgrade google-api-python-client google-auth-httplib2 google-auth-oauthlib"))),(0,i.kt)("h2",{id:"instructions-for-retrieving-your-google-docs-data"},"Instructions for retrieving your Google Docs data"),(0,i.kt)("p",null,"By default, the ",(0,i.kt)("inlineCode",{parentName:"p"},"GoogleDriveRetriever")," expects the ",(0,i.kt)("inlineCode",{parentName:"p"},"credentials.json")," file to be ",(0,i.kt)("inlineCode",{parentName:"p"},"~/.credentials/credentials.json"),", but this is configurable using the ",(0,i.kt)("inlineCode",{parentName:"p"},"GOOGLE_ACCOUNT_FILE")," environment variable.\nThe location of ",(0,i.kt)("inlineCode",{parentName:"p"},"token.json")," use the same directory (or use the parameter ",(0,i.kt)("inlineCode",{parentName:"p"},"token_path"),"). Note that ",(0,i.kt)("inlineCode",{parentName:"p"},"token.json")," will be created automatically the first time you use the retriever."),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"GoogleDriveRetriever")," can retrieve a selection of files with some requests. "),(0,i.kt)("p",null,"By default, If you use a ",(0,i.kt)("inlineCode",{parentName:"p"},"folder_id"),", all the files inside this folder can be retrieved to ",(0,i.kt)("inlineCode",{parentName:"p"},"Document"),"."),(0,i.kt)("p",null,"You can obtain your folder and document id from the URL:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Folder: ",(0,i.kt)("a",{parentName:"li",href:"https://drive.google.com/drive/u/0/folders/1yucgL9WGgWZdM1TOuKkeghlPizuzMYb5"},"https://drive.google.com/drive/u/0/folders/1yucgL9WGgWZdM1TOuKkeghlPizuzMYb5")," -> folder id is ",(0,i.kt)("inlineCode",{parentName:"li"},'"1yucgL9WGgWZdM1TOuKkeghlPizuzMYb5"')),(0,i.kt)("li",{parentName:"ul"},"Document: ",(0,i.kt)("a",{parentName:"li",href:"https://docs.google.com/document/d/1bfaMQ18_i56204VaQDVeAFpqEijJTgvurupdEDiaUQw/edit"},"https://docs.google.com/document/d/1bfaMQ18_i56204VaQDVeAFpqEijJTgvurupdEDiaUQw/edit")," -> document id is ",(0,i.kt)("inlineCode",{parentName:"li"},'"1bfaMQ18_i56204VaQDVeAFpqEijJTgvurupdEDiaUQw"'))),(0,i.kt)("p",null,"The special value ",(0,i.kt)("inlineCode",{parentName:"p"},"root")," is for your personal home."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},"#!pip install --upgrade google-api-python-client google-auth-httplib2 google-auth-oauthlib\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},"from langchain_googledrive.retrievers import GoogleDriveRetriever\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},"folder_id=\"root\"\n#folder_id='1yucgL9WGgWZdM1TOuKkeghlPizuzMYb5'\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},"retriever = GoogleDriveRetriever(\n    num_results=2,\n)\n")),(0,i.kt)("p",null,"By default, all files with these mime-type can be converted to ",(0,i.kt)("inlineCode",{parentName:"p"},"Document"),"."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"text/text"),(0,i.kt)("li",{parentName:"ul"},"text/plain"),(0,i.kt)("li",{parentName:"ul"},"text/html"),(0,i.kt)("li",{parentName:"ul"},"text/csv"),(0,i.kt)("li",{parentName:"ul"},"text/markdown"),(0,i.kt)("li",{parentName:"ul"},"image/png"),(0,i.kt)("li",{parentName:"ul"},"image/jpeg"),(0,i.kt)("li",{parentName:"ul"},"application/epub+zip"),(0,i.kt)("li",{parentName:"ul"},"application/pdf"),(0,i.kt)("li",{parentName:"ul"},"application/rtf"),(0,i.kt)("li",{parentName:"ul"},"application/vnd.google-apps.document (GDoc)"),(0,i.kt)("li",{parentName:"ul"},"application/vnd.google-apps.presentation (GSlide)"),(0,i.kt)("li",{parentName:"ul"},"application/vnd.google-apps.spreadsheet (GSheet)"),(0,i.kt)("li",{parentName:"ul"},"application/vnd.google.colaboratory (Notebook colab)"),(0,i.kt)("li",{parentName:"ul"},"application/vnd.openxmlformats-officedocument.presentationml.presentation (PPTX)"),(0,i.kt)("li",{parentName:"ul"},"application/vnd.openxmlformats-officedocument.wordprocessingml.document (DOCX)")),(0,i.kt)("p",null,"It's possible to update or customize this. See the documentation of ",(0,i.kt)("inlineCode",{parentName:"p"},"GDriveRetriever"),"."),(0,i.kt)("p",null,"But, the corresponding packages must be installed."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},"#!pip install unstructured\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},'retriever.get_relevant_documents("machine learning")\n')),(0,i.kt)("p",null,"You can customize the criteria to select the files. A set of predefined filter are proposed:\n| template                               | description                                                           |\n| -------------------------------------- | --------------------------------------------------------------------- |\n| gdrive-all-in-folder                   | Return all compatible files from a ",(0,i.kt)("inlineCode",{parentName:"p"},"folder_id"),"                        |\n| gdrive-query                           | Search ",(0,i.kt)("inlineCode",{parentName:"p"},"query")," in all drives                                          |\n| gdrive-by-name                         | Search file with name ",(0,i.kt)("inlineCode",{parentName:"p"},"query"),")                                        |\n| gdrive-query-in-folder                 | Search ",(0,i.kt)("inlineCode",{parentName:"p"},"query")," in ",(0,i.kt)("inlineCode",{parentName:"p"},"folder_id")," (and sub-folders in ",(0,i.kt)("inlineCode",{parentName:"p"},"_recursive=true"),")  |\n| gdrive-mime-type                       | Search a specific ",(0,i.kt)("inlineCode",{parentName:"p"},"mime_type"),"                                         |\n| gdrive-mime-type-in-folder             | Search a specific ",(0,i.kt)("inlineCode",{parentName:"p"},"mime_type")," in ",(0,i.kt)("inlineCode",{parentName:"p"},"folder_id"),"                          |\n| gdrive-query-with-mime-type            | Search ",(0,i.kt)("inlineCode",{parentName:"p"},"query")," with a specific ",(0,i.kt)("inlineCode",{parentName:"p"},"mime_type"),"                            |\n| gdrive-query-with-mime-type-and-folder | Search ",(0,i.kt)("inlineCode",{parentName:"p"},"query")," with a specific ",(0,i.kt)("inlineCode",{parentName:"p"},"mime_type")," and in ",(0,i.kt)("inlineCode",{parentName:"p"},"folder_id"),"         |"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},'retriever = GoogleDriveRetriever(\n    template="gdrive-query", # Search everywhere\n    num_results=2,  # But take only 2 documents\n)\nfor doc in retriever.get_relevant_documents("machine learning"):\n    print("---")\n    print(doc.page_content.strip()[:60]+"...")\n')),(0,i.kt)("p",null,"Else, you can customize the prompt with a specialized ",(0,i.kt)("inlineCode",{parentName:"p"},"PromptTemplate")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},'from langchain import PromptTemplate\nretriever = GoogleDriveRetriever(\n    template=PromptTemplate(input_variables=[\'query\'],\n                            # See https://developers.google.com/drive/api/guides/search-files\n                            template="(fullText contains \'{query}\') "\n                              "and mimeType=\'application/vnd.google-apps.document\' "\n                              "and modifiedTime > \'2000-01-01T00:00:00\' "\n                              "and trashed=false"),\n    num_results=2,\n    # See https://developers.google.com/drive/api/v3/reference/files/list\n    includeItemsFromAllDrives=False,\n    supportsAllDrives=False,\n)\nfor doc in retriever.get_relevant_documents("machine learning"):\n    print(f"{doc.metadata[\'name\']}:")\n    print("---")\n    print(doc.page_content.strip()[:60]+"...")\n')),(0,i.kt)("h1",{id:"use-gdrive-description-metadata"},"Use GDrive 'description' metadata"),(0,i.kt)("p",null,"Each Google Drive has a ",(0,i.kt)("inlineCode",{parentName:"p"},"description")," field in metadata (see the ",(0,i.kt)("em",{parentName:"p"},"details of a file"),").\nUse the ",(0,i.kt)("inlineCode",{parentName:"p"},"snippets")," mode to return the description of selected files."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},"retriever = GoogleDriveRetriever(\n    template='gdrive-mime-type-in-folder',\n    folder_id=folder_id,\n    mime_type='application/vnd.google-apps.document',  # Only Google Docs\n    num_results=2,\n    mode='snippets',\n    includeItemsFromAllDrives=False,\n    supportsAllDrives=False,\n)\nretriever.get_relevant_documents(\"machine learning\")\n")))}u.isMDXComponent=!0}}]);