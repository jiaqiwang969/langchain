"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[1733],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>m});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},s=Object.keys(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),p=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=p(e.components);return a.createElement(l.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,s=e.originalType,l=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),u=p(n),h=r,m=u["".concat(l,".").concat(h)]||u[h]||d[h]||s;return n?a.createElement(m,o(o({ref:t},c),{},{components:n})):a.createElement(m,o({ref:t},c))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var s=n.length,o=new Array(s);o[0]=h;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i[u]="string"==typeof e?e:r,o[1]=i;for(var p=2;p<s;p++)o[p]=n[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},90359:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>m,frontMatter:()=>s,metadata:()=>i,toc:()=>p});var a=n(87462),r=(n(67294),n(3905));const s={},o="QA using Activeloop's DeepLake",i={unversionedId:"use_cases/question_answering/integrations/semantic-search-over-chat",id:"use_cases/question_answering/integrations/semantic-search-over-chat",title:"QA using Activeloop's DeepLake",description:"In this tutorial, we are going to use Langchain + Activeloop's Deep Lake with GPT4 to semantically search and ask questions over a group chat.",source:"@site/docs/use_cases/question_answering/integrations/semantic-search-over-chat.md",sourceDirName:"use_cases/question_answering/integrations",slug:"/use_cases/question_answering/integrations/semantic-search-over-chat",permalink:"/langchain/docs/use_cases/question_answering/integrations/semantic-search-over-chat",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"use_cases",previous:{title:"Structure answers with OpenAI functions",permalink:"/langchain/docs/use_cases/question_answering/integrations/openai_functions_retrieval_qa"},next:{title:"SQL",permalink:"/langchain/docs/use_cases/qa_structured/sql"}},l={},p=[{value:"1. Install required packages",id:"1-install-required-packages",level:2},{value:"2. Add API keys",id:"2-add-api-keys",level:2},{value:"2. Create sample data",id:"2-create-sample-data",level:2},{value:"3. Ingest chat embeddings",id:"3-ingest-chat-embeddings",level:2},{value:"4. Ask questions",id:"4-ask-questions",level:2}],c=(u="CodeOutputBlock",function(e){return console.warn("Component "+u+" was not imported, exported, or provided by MDXProvider as global scope"),(0,r.kt)("div",e)});var u;const d={toc:p},h="wrapper";function m(e){let{components:t,...n}=e;return(0,r.kt)(h,(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"qa-using-activeloops-deeplake"},"QA using Activeloop's DeepLake"),(0,r.kt)("p",null,"In this tutorial, we are going to use Langchain + Activeloop's Deep Lake with GPT4 to semantically search and ask questions over a group chat."),(0,r.kt)("p",null,"View a working demo ",(0,r.kt)("a",{parentName:"p",href:"https://twitter.com/thisissukh_/status/1647223328363679745"},"here")),(0,r.kt)("h2",{id:"1-install-required-packages"},"1. Install required packages"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"python3 -m pip install --upgrade langchain 'deeplake[enterprise]' openai tiktoken\n")),(0,r.kt)("h2",{id:"2-add-api-keys"},"2. Add API keys"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'import os\nimport getpass\nfrom langchain.document_loaders import PyPDFLoader, TextLoader\nfrom langchain.embeddings.openai import OpenAIEmbeddings\nfrom langchain.text_splitter import (\n    RecursiveCharacterTextSplitter,\n    CharacterTextSplitter,\n)\nfrom langchain.vectorstores import DeepLake\nfrom langchain.chains import ConversationalRetrievalChain, RetrievalQA\nfrom langchain.chat_models import ChatOpenAI\nfrom langchain.llms import OpenAI\n\nos.environ["OPENAI_API_KEY"] = getpass.getpass("OpenAI API Key:")\nactiveloop_token = getpass.getpass("Activeloop Token:")\nos.environ["ACTIVELOOP_TOKEN"] = activeloop_token\nos.environ["ACTIVELOOP_ORG"] = getpass.getpass("Activeloop Org:")\n\norg_id = os.environ["ACTIVELOOP_ORG"]\nembeddings = OpenAIEmbeddings()\n\ndataset_path = "hub://" + org_id + "/data"\n')),(0,r.kt)("h2",{id:"2-create-sample-data"},"2. Create sample data"),(0,r.kt)("p",null,"You can generate a sample group chat conversation using ChatGPT with this prompt:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"Generate a group chat conversation with three friends talking about their day, referencing real places and fictional names. Make it funny and as detailed as possible.\n")),(0,r.kt)("p",null,"I've already generated such a chat in ",(0,r.kt)("inlineCode",{parentName:"p"},"messages.txt"),". We can keep it simple and use this for our example."),(0,r.kt)("h2",{id:"3-ingest-chat-embeddings"},"3. Ingest chat embeddings"),(0,r.kt)("p",null,"We load the messages in the text file, chunk and upload to ActiveLoop Vector store."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'with open("messages.txt") as f:\n    state_of_the_union = f.read()\ntext_splitter = CharacterTextSplitter(chunk_size=1000, chunk_overlap=0)\npages = text_splitter.split_text(state_of_the_union)\n\ntext_splitter = RecursiveCharacterTextSplitter(chunk_size=1000, chunk_overlap=100)\ntexts = text_splitter.create_documents(pages)\n\nprint(texts)\n\ndataset_path = "hub://" + org_id + "/data"\nembeddings = OpenAIEmbeddings()\ndb = DeepLake.from_documents(\n    texts, embeddings, dataset_path=dataset_path, overwrite=True\n)\n')),(0,r.kt)(c,{lang:"python",mdxType:"CodeOutputBlock"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"    [Document(page_content='Participants:\\n\\nJerry: Loves movies and is a bit of a klutz.\\nSamantha: Enthusiastic about food and always trying new restaurants.\\nBarry: A nature lover, but always manages to get lost.\\nJerry: Hey, guys! You won\\'t believe what happened to me at the Times Square AMC theater. I tripped over my own feet and spilled popcorn everywhere! \ud83c\udf7f\ud83d\udca5\\n\\nSamantha: LOL, that\\'s so you, Jerry! Was the floor buttery enough for you to ice skate on after that? \ud83d\ude02\\n\\nBarry: Sounds like a regular Tuesday for you, Jerry. Meanwhile, I tried to find that new hiking trail in Central Park. You know, the one that\\'s supposed to be impossible to get lost on? Well, guess what...\\n\\nJerry: You found a hidden treasure?\\n\\nBarry: No, I got lost. AGAIN. \ud83e\udded\ud83d\ude44\\n\\nSamantha: Barry, you\\'d get lost in your own backyard! But speaking of treasures, I found this new sushi place in Little Tokyo. \"Samantha\\'s Sushi Symphony\" it\\'s called. Coincidence? I think not!\\n\\nJerry: Maybe they named it after your ability to eat your body weight in sushi. \ud83c\udf63', metadata={}), Document(page_content='Barry: How do you even FIND all these places, Samantha?\\n\\nSamantha: Simple, I don\\'t rely on Barry\\'s navigation skills. \ud83d\ude09 But seriously, the wasabi there was hotter than Jerry\\'s love for Marvel movies!\\n\\nJerry: Hey, nothing wrong with a little superhero action. By the way, did you guys see the new \"Captain Crunch: Breakfast Avenger\" trailer?\\n\\nSamantha: Captain Crunch? Are you sure you didn\\'t get that from one of your Saturday morning cereal binges?\\n\\nBarry: Yeah, and did he defeat his arch-enemy, General Mills? \ud83d\ude06\\n\\nJerry: Ha-ha, very funny. Anyway, that sushi place sounds awesome, Samantha. Next time, let\\'s go together, and maybe Barry can guide us... if we want a city-wide tour first.\\n\\nBarry: As long as we\\'re not hiking, I\\'ll get us there... eventually. \ud83d\ude05\\n\\nSamantha: It\\'s a date! But Jerry, you\\'re banned from carrying any food items.\\n\\nJerry: Deal! Just promise me no wasabi challenges. I don\\'t want to end up like the time I tried Sriracha ice cream.', metadata={}), Document(page_content=\"Barry: Wait, what happened with Sriracha ice cream?\\n\\nJerry: Let's just say it was a hot situation. Literally. \ud83d\udd25\\n\\nSamantha: \ud83e\udd23 I still have the video!\\n\\nJerry: Samantha, if you value our friendship, that video will never see the light of day.\\n\\nSamantha: No promises, Jerry. No promises. \ud83e\udd10\ud83d\ude08\\n\\nBarry: I foresee a fun weekend ahead! \ud83c\udf89\", metadata={})]\n    Your Deep Lake dataset has been successfully created!\n\n\n    \\\n\n    Dataset(path='hub://adilkhan/data', tensors=['embedding', 'id', 'metadata', 'text'])\n    \n      tensor      htype      shape     dtype  compression\n      -------    -------    -------   -------  ------- \n     embedding  embedding  (3, 1536)  float32   None   \n        id        text      (3, 1)      str     None   \n     metadata     json      (3, 1)      str     None   \n       text       text      (3, 1)      str     None   \n\n\n     \n"))),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"Optional"),": You can also use Deep Lake's Managed Tensor Database as a hosting service and run queries there. In order to do so, it is necessary to specify the runtime parameter as {'tensor_db': True} during the creation of the vector store. This configuration enables the execution of queries on the Managed Tensor Database, rather than on the client side. It should be noted that this functionality is not applicable to datasets stored locally or in-memory. In the event that a vector store has already been created outside of the Managed Tensor Database, it is possible to transfer it to the Managed Tensor Database by following the prescribed steps."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'# with open("messages.txt") as f:\n#     state_of_the_union = f.read()\n# text_splitter = CharacterTextSplitter(chunk_size=1000, chunk_overlap=0)\n# pages = text_splitter.split_text(state_of_the_union)\n\n# text_splitter = RecursiveCharacterTextSplitter(chunk_size=1000, chunk_overlap=100)\n# texts = text_splitter.create_documents(pages)\n\n# print(texts)\n\n# dataset_path = "hub://" + org + "/data"\n# embeddings = OpenAIEmbeddings()\n# db = DeepLake.from_documents(\n#     texts, embeddings, dataset_path=dataset_path, overwrite=True, runtime={"tensor_db": True}\n# )\n')),(0,r.kt)("h2",{id:"4-ask-questions"},"4. Ask questions"),(0,r.kt)("p",null,"Now we can ask a question and get an answer back with a semantic search:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'db = DeepLake(dataset_path=dataset_path, read_only=True, embedding=embeddings)\n\nretriever = db.as_retriever()\nretriever.search_kwargs["distance_metric"] = "cos"\nretriever.search_kwargs["k"] = 4\n\nqa = RetrievalQA.from_chain_type(\n    llm=OpenAI(), chain_type="stuff", retriever=retriever, return_source_documents=False\n)\n\n# What was the restaurant the group was talking about called?\nquery = input("Enter query:")\n\n# The Hungry Lobster\nans = qa({"query": query})\n\nprint(ans)\n')))}m.isMDXComponent=!0}}]);