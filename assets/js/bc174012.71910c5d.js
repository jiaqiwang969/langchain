"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[8002],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>h});var o=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},a=Object.keys(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var m=o.createContext({}),l=function(e){var t=o.useContext(m),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=l(e.components);return o.createElement(m.Provider,{value:t},e.children)},p="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},d=o.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,m=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),p=l(n),d=r,h=p["".concat(m,".").concat(d)]||p[d]||u[d]||a;return n?o.createElement(h,i(i({ref:t},c),{},{components:n})):o.createElement(h,i({ref:t},c))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,i=new Array(a);i[0]=d;var s={};for(var m in t)hasOwnProperty.call(t,m)&&(s[m]=t[m]);s.originalType=e,s[p]="string"==typeof e?e:r,i[1]=s;for(var l=2;l<a;l++)i[l]=n[l];return o.createElement.apply(null,i)}return o.createElement.apply(null,n)}d.displayName="MDXCreateElement"},83589:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>p,default:()=>v,frontMatter:()=>c,metadata:()=>u,toc:()=>h});var o=n(87462),r=(n(67294),n(3905));const a=(i="CodeOutputBlock",function(e){return console.warn("Component "+i+" was not imported, exported, or provided by MDXProvider as global scope"),(0,r.kt)("div",e)});var i;const s={toc:[{value:"Initialize your vector store",id:"initialize-your-vector-store",level:3},{value:"Create your <code>VectorStoreRetrieverMemory</code>",id:"create-your-vectorstoreretrievermemory",level:3},{value:"Using in a chain",id:"using-in-a-chain",level:2}]},m="wrapper";function l(e){let{components:t,...n}=e;return(0,r.kt)(m,(0,o.Z)({},s,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},"from datetime import datetime\nfrom langchain.embeddings.openai import OpenAIEmbeddings\nfrom langchain.llms import OpenAI\nfrom langchain.memory import VectorStoreRetrieverMemory\nfrom langchain.chains import ConversationChain\nfrom langchain.prompts import PromptTemplate\n")),(0,r.kt)("h3",{id:"initialize-your-vector-store"},"Initialize your vector store"),(0,r.kt)("p",null,"Depending on the store you choose, this step may look different. Consult the relevant vector store documentation for more details."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},"import faiss\n\nfrom langchain.docstore import InMemoryDocstore\nfrom langchain.vectorstores import FAISS\n\n\nembedding_size = 1536 # Dimensions of the OpenAIEmbeddings\nindex = faiss.IndexFlatL2(embedding_size)\nembedding_fn = OpenAIEmbeddings().embed_query\nvectorstore = FAISS(embedding_fn, index, InMemoryDocstore({}), {})\n")),(0,r.kt)("h3",{id:"create-your-vectorstoreretrievermemory"},"Create your ",(0,r.kt)("inlineCode",{parentName:"h3"},"VectorStoreRetrieverMemory")),(0,r.kt)("p",null,"The memory object is instantiated from any vector store retriever."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'# In actual usage, you would set `k` to be a higher value, but we use k=1 to show that\n# the vector lookup still returns the semantically relevant information\nretriever = vectorstore.as_retriever(search_kwargs=dict(k=1))\nmemory = VectorStoreRetrieverMemory(retriever=retriever)\n\n# When added to an agent, the memory object can save pertinent information from conversations or used tools\nmemory.save_context({"input": "My favorite food is pizza"}, {"output": "that\'s good to know"})\nmemory.save_context({"input": "My favorite sport is soccer"}, {"output": "..."})\nmemory.save_context({"input": "I don\'t the Celtics"}, {"output": "ok"}) #\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'# Notice the first result returned is the memory pertaining to tax help, which the language model deems more semantically relevant\n# to a 1099 than the other documents, despite them both containing numbers.\nprint(memory.load_memory_variables({"prompt": "what sport should i watch?"})["history"])\n')),(0,r.kt)(a,{lang:"python",mdxType:"CodeOutputBlock"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"    input: My favorite sport is soccer\n    output: ...\n"))),(0,r.kt)("h2",{id:"using-in-a-chain"},"Using in a chain"),(0,r.kt)("p",null,"Let's walk through an example, again setting ",(0,r.kt)("inlineCode",{parentName:"p"},"verbose=True")," so we can see the prompt."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'llm = OpenAI(temperature=0) # Can be any valid LLM\n_DEFAULT_TEMPLATE = """The following is a friendly conversation between a human and an AI. The AI is talkative and provides lots of specific details from its context. If the AI does not know the answer to a question, it truthfully says it does not know.\n\nRelevant pieces of previous conversation:\n{history}\n\n(You do not need to use these pieces of information if not relevant)\n\nCurrent conversation:\nHuman: {input}\nAI:"""\nPROMPT = PromptTemplate(\n    input_variables=["history", "input"], template=_DEFAULT_TEMPLATE\n)\nconversation_with_summary = ConversationChain(\n    llm=llm, \n    prompt=PROMPT,\n    # We set a very low max_token_limit for the purposes of testing.\n    memory=memory,\n    verbose=True\n)\nconversation_with_summary.predict(input="Hi, my name is Perry, what\'s up?")\n')),(0,r.kt)(a,{lang:"python",mdxType:"CodeOutputBlock"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"    \n    \n    > Entering new ConversationChain chain...\n    Prompt after formatting:\n    The following is a friendly conversation between a human and an AI. The AI is talkative and provides lots of specific details from its context. If the AI does not know the answer to a question, it truthfully says it does not know.\n    \n    Relevant pieces of previous conversation:\n    input: My favorite food is pizza\n    output: that's good to know\n    \n    (You do not need to use these pieces of information if not relevant)\n    \n    Current conversation:\n    Human: Hi, my name is Perry, what's up?\n    AI:\n    \n    > Finished chain.\n\n\n\n\n\n    \" Hi Perry, I'm doing well. How about you?\"\n"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'# Here, the basketball related content is surfaced\nconversation_with_summary.predict(input="what\'s my favorite sport?")\n')),(0,r.kt)(a,{lang:"python",mdxType:"CodeOutputBlock"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"    \n    \n    > Entering new ConversationChain chain...\n    Prompt after formatting:\n    The following is a friendly conversation between a human and an AI. The AI is talkative and provides lots of specific details from its context. If the AI does not know the answer to a question, it truthfully says it does not know.\n    \n    Relevant pieces of previous conversation:\n    input: My favorite sport is soccer\n    output: ...\n    \n    (You do not need to use these pieces of information if not relevant)\n    \n    Current conversation:\n    Human: what's my favorite sport?\n    AI:\n    \n    > Finished chain.\n\n\n\n\n\n    ' You told me earlier that your favorite sport is soccer.'\n"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'# Even though the language model is stateless, since relevant memory is fetched, it can "reason" about the time.\n# Timestamping memories and data is useful in general to let the agent determine temporal relevance\nconversation_with_summary.predict(input="Whats my favorite food")\n')),(0,r.kt)(a,{lang:"python",mdxType:"CodeOutputBlock"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"    \n    \n    > Entering new ConversationChain chain...\n    Prompt after formatting:\n    The following is a friendly conversation between a human and an AI. The AI is talkative and provides lots of specific details from its context. If the AI does not know the answer to a question, it truthfully says it does not know.\n    \n    Relevant pieces of previous conversation:\n    input: My favorite food is pizza\n    output: that's good to know\n    \n    (You do not need to use these pieces of information if not relevant)\n    \n    Current conversation:\n    Human: Whats my favorite food\n    AI:\n    \n    > Finished chain.\n\n\n\n\n\n    ' You said your favorite food is pizza.'\n"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},"# The memories from the conversation are automatically stored,\n# since this query best matches the introduction chat above,\n# the agent is able to 'remember' the user's name.\nconversation_with_summary.predict(input=\"What's my name?\")\n")),(0,r.kt)(a,{lang:"python",mdxType:"CodeOutputBlock"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"    \n    \n    > Entering new ConversationChain chain...\n    Prompt after formatting:\n    The following is a friendly conversation between a human and an AI. The AI is talkative and provides lots of specific details from its context. If the AI does not know the answer to a question, it truthfully says it does not know.\n    \n    Relevant pieces of previous conversation:\n    input: Hi, my name is Perry, what's up?\n    response:  Hi Perry, I'm doing well. How about you?\n    \n    (You do not need to use these pieces of information if not relevant)\n    \n    Current conversation:\n    Human: What's my name?\n    AI:\n    \n    > Finished chain.\n\n\n\n\n\n    ' Your name is Perry.'\n"))))}l.isMDXComponent=!0;const c={},p="Backed by a Vector Store",u={unversionedId:"modules/memory/types/vectorstore_retriever_memory",id:"modules/memory/types/vectorstore_retriever_memory",title:"Backed by a Vector Store",description:'VectorStoreRetrieverMemory stores memories in a vector store and queries the top-K most "salient" docs every time it is called.',source:"@site/docs/modules/memory/types/vectorstore_retriever_memory.mdx",sourceDirName:"modules/memory/types",slug:"/modules/memory/types/vectorstore_retriever_memory",permalink:"/langchain/docs/modules/memory/types/vectorstore_retriever_memory",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"docs",previous:{title:"Conversation Token Buffer",permalink:"/langchain/docs/modules/memory/types/token_buffer"},next:{title:"Memory in LLMChain",permalink:"/langchain/docs/modules/memory/adding_memory"}},d={},h=[],y={toc:h},f="wrapper";function v(e){let{components:t,...n}=e;return(0,r.kt)(f,(0,o.Z)({},y,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"backed-by-a-vector-store"},"Backed by a Vector Store"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"VectorStoreRetrieverMemory"),' stores memories in a vector store and queries the top-K most "salient" docs every time it is called.'),(0,r.kt)("p",null,"This differs from most of the other Memory classes in that it doesn't explicitly track the order of interactions."),(0,r.kt)("p",null,'In this case, the "docs" are previous conversation snippets. This can be useful to refer to relevant pieces of information that the AI was told earlier in the conversation.'),(0,r.kt)(l,{mdxType:"Example"}))}v.isMDXComponent=!0}}]);