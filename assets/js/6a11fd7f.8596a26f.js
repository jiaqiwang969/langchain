"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[60775],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>h});var o=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var i=o.createContext({}),p=function(e){var t=o.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},u=function(e){var t=p(e.components);return o.createElement(i.Provider,{value:t},e.children)},c="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},g=o.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,i=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),c=p(n),g=a,h=c["".concat(i,".").concat(g)]||c[g]||m[g]||r;return n?o.createElement(h,s(s({ref:t},u),{},{components:n})):o.createElement(h,s({ref:t},u))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,s=new Array(r);s[0]=g;var l={};for(var i in t)hasOwnProperty.call(t,i)&&(l[i]=t[i]);l.originalType=e,l[c]="string"==typeof e?e:a,s[1]=l;for(var p=2;p<r;p++)s[p]=n[p];return o.createElement.apply(null,s)}return o.createElement.apply(null,n)}g.displayName="MDXCreateElement"},49248:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>g,contentTitle:()=>c,default:()=>f,frontMatter:()=>u,metadata:()=>m,toc:()=>h});var o=n(87462),a=(n(67294),n(3905));const r=(s="CodeOutputBlock",function(e){return console.warn("Component "+s+" was not imported, exported, or provided by MDXProvider as global scope"),(0,a.kt)("div",e)});var s;const l={toc:[{value:"Set up the agent",id:"set-up-the-agent",level:3}]},i="wrapper";function p(e){let{components:t,...n}=e;return(0,a.kt)(i,(0,o.Z)({},l,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"This will go over how to get started building an agent.\nWe will use a LangChain agent class, but show how to customize it to give it specific context.\nWe will then define custom tools, and then run it all in the standard LangChain ",(0,a.kt)("inlineCode",{parentName:"p"},"AgentExecutor"),"."),(0,a.kt)("h3",{id:"set-up-the-agent"},"Set up the agent"),(0,a.kt)("p",null,"We will use the ",(0,a.kt)("inlineCode",{parentName:"p"},"OpenAIFunctionsAgent"),".\nThis is easiest and best agent to get started with.\nIt does however require usage of ",(0,a.kt)("inlineCode",{parentName:"p"},"ChatOpenAI")," models.\nIf you want to use a different language model, we would recommend using the ",(0,a.kt)("a",{parentName:"p",href:"/docs/modules/agents/agent_types/react"},"ReAct")," agent."),(0,a.kt)("p",null,"For this guide, we will construct a custom agent that has access to a custom tool.\nWe are choosing this example because we think for most use cases you will NEED to customize either the agent or the tools.\nThe tool we will give the agent is a tool to calculate the length of a word.\nThis is useful because this is actually something LLMs can mess up due to tokenization.\nWe will first create it WITHOUT memory, but we will then show how to add memory in.\nMemory is needed to enable conversation."),(0,a.kt)("p",null,"First, let's load the language model we're going to use to control the agent."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-python"},"from langchain.chat_models import ChatOpenAI\nllm = ChatOpenAI(temperature=0)\n")),(0,a.kt)("p",null,"Next, let's define some tools to use.\nLet's write a really simple Python function to calculate the length of a word that is passed in."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-python"},'from langchain.agents import tool\n\n@tool\ndef get_word_length(word: str) -> int:\n    """Returns the length of a word."""\n    return len(word)\n\ntools = [get_word_length]\n')),(0,a.kt)("p",null,"Now let us create the prompt.\nWe can use the ",(0,a.kt)("inlineCode",{parentName:"p"},"OpenAIFunctionsAgent.create_prompt")," helper function to create a prompt automatically.\nThis allows for a few different ways to customize, including passing in a custom ",(0,a.kt)("inlineCode",{parentName:"p"},"SystemMessage"),", which we will do."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-python"},'from langchain.schema import SystemMessage\nfrom langchain.agents import OpenAIFunctionsAgent\nsystem_message = SystemMessage(content="You are very powerful assistant, but bad at calculating lengths of words.")\nprompt = OpenAIFunctionsAgent.create_prompt(system_message=system_message)\n')),(0,a.kt)("p",null,"Putting those pieces together, we can now create the agent."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-python"},"agent = OpenAIFunctionsAgent(llm=llm, tools=tools, prompt=prompt)\n")),(0,a.kt)("p",null,"Finally, we create the ",(0,a.kt)("inlineCode",{parentName:"p"},"AgentExecutor")," - the runtime for our agent."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-python"},"from langchain.agents import AgentExecutor\nagent_executor = AgentExecutor(agent=agent, tools=tools, verbose=True)\n")),(0,a.kt)("p",null,"Now let's test it out!"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-python"},'agent_executor.run("how many letters in the word educa?")\n')),(0,a.kt)(r,{lang:"python",mdxType:"CodeOutputBlock"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"    \n    \n    > Entering new AgentExecutor chain...\n\n    Invoking: `get_word_length` with `{'word': 'educa'}`\n\n    5\n\n    There are 5 letters in the word \"educa\".\n\n    > Finished chain.\n\n    'There are 5 letters in the word \"educa\".'\n"))),(0,a.kt)("p",null,"This is great - we have an agent!\nHowever, this agent is stateless - it doesn't remember anything about previous interactions.\nThis means you can't ask follow up questions easily.\nLet's fix that by adding in memory."),(0,a.kt)("p",null,"In order to do this, we need to do two things:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Add a place for memory variables to go in the prompt"),(0,a.kt)("li",{parentName:"ol"},"Add memory to the ",(0,a.kt)("inlineCode",{parentName:"li"},"AgentExecutor")," (note that we add it here, and NOT to the agent, as this is the outermost chain)")),(0,a.kt)("p",null,"First, let's add a place for memory in the prompt.\nWe do this by adding a placeholder for messages with the key ",(0,a.kt)("inlineCode",{parentName:"p"},'"chat_history"'),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-python"},'from langchain.prompts import MessagesPlaceholder\n\nMEMORY_KEY = "chat_history"\nprompt = OpenAIFunctionsAgent.create_prompt(\n    system_message=system_message,\n    extra_prompt_messages=[MessagesPlaceholder(variable_name=MEMORY_KEY)]\n)\n')),(0,a.kt)("p",null,"Next, let's create a memory object.\nWe will do this by using ",(0,a.kt)("inlineCode",{parentName:"p"},"ConversationBufferMemory"),".\nImportantly, we set ",(0,a.kt)("inlineCode",{parentName:"p"},"memory_key")," also equal to ",(0,a.kt)("inlineCode",{parentName:"p"},'"chat_history"')," (to align it with the prompt) and set ",(0,a.kt)("inlineCode",{parentName:"p"},"return_messages")," (to make it return messages rather than a string)."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-python"},"from langchain.memory import ConversationBufferMemory\n\nmemory = ConversationBufferMemory(memory_key=MEMORY_KEY, return_messages=True)\n")),(0,a.kt)("p",null,"We can then put it all together!"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-python"},'agent = OpenAIFunctionsAgent(llm=llm, tools=tools, prompt=prompt)\nagent_executor = AgentExecutor(agent=agent, tools=tools, memory=memory, verbose=True)\nagent_executor.run("how many letters in the word educa?")\nagent_executor.run("is that a real word?")\n')))}p.isMDXComponent=!0;const u={sidebar_position:4},c="Agents",m={unversionedId:"modules/agents/index",id:"modules/agents/index",title:"Agents",description:"The core idea of agents is to use an LLM to choose a sequence of actions to take.",source:"@site/docs/modules/agents/index.mdx",sourceDirName:"modules/agents",slug:"/modules/agents/",permalink:"/langchain/docs/modules/agents/",draft:!1,tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4},sidebar:"docs",previous:{title:"Multiple Memory classes",permalink:"/langchain/docs/modules/memory/multiple_memory"},next:{title:"Agent types",permalink:"/langchain/docs/modules/agents/agent_types/"}},g={},h=[{value:"Agent",id:"agent",level:2},{value:"Tools",id:"tools",level:2},{value:"Toolkits",id:"toolkits",level:2},{value:"AgentExecutor",id:"agentexecutor",level:2},{value:"Other types of agent runtimes",id:"other-types-of-agent-runtimes",level:2},{value:"Get started",id:"get-started",level:2}],d={toc:h},k="wrapper";function f(e){let{components:t,...n}=e;return(0,a.kt)(k,(0,o.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"agents"},"Agents"),(0,a.kt)("p",null,"The core idea of agents is to use an LLM to choose a sequence of actions to take.\nIn chains, a sequence of actions is hardcoded (in code).\nIn agents, a language model is used as a reasoning engine to determine which actions to take and in which order."),(0,a.kt)("p",null,"There are several key components here:"),(0,a.kt)("h2",{id:"agent"},"Agent"),(0,a.kt)("p",null,"This is the class responsible for deciding what step to take next.\nThis is powered by a language model and a prompt.\nThis prompt can include things like:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"The personality of the agent (useful for having it respond in a certain way)"),(0,a.kt)("li",{parentName:"ol"},"Background context for the agent (useful for giving it more context on the types of tasks it's being asked to do)"),(0,a.kt)("li",{parentName:"ol"},"Prompting strategies to invoke better reasoning (the most famous/widely used being ",(0,a.kt)("a",{parentName:"li",href:"https://arxiv.org/abs/2210.03629"},"ReAct"),")")),(0,a.kt)("p",null,"LangChain provides a few different types of agents to get started.\nEven then, you will likely want to customize those agents with parts (1) and (2).\nFor a full list of agent types see ",(0,a.kt)("a",{parentName:"p",href:"/docs/modules/agents/agent_types/"},"agent types")),(0,a.kt)("h2",{id:"tools"},"Tools"),(0,a.kt)("p",null,"Tools are functions that an agent calls.\nThere are two important considerations here:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Giving the agent access to the right tools"),(0,a.kt)("li",{parentName:"ol"},"Describing the tools in a way that is most helpful to the agent")),(0,a.kt)("p",null,"Without both, the agent you are trying to build will not work.\nIf you don't give the agent access to a correct set of tools, it will never be able to accomplish the objective.\nIf you don't describe the tools properly, the agent won't know how to properly use them."),(0,a.kt)("p",null,"LangChain provides a wide set of tools to get started, but also makes it easy to define your own (including custom descriptions).\nFor a full list of tools, see ",(0,a.kt)("a",{parentName:"p",href:"/docs/modules/agents/tools/"},"here")),(0,a.kt)("h2",{id:"toolkits"},"Toolkits"),(0,a.kt)("p",null,"Often the set of tools an agent has access to is more important than a single tool.\nFor this LangChain provides the concept of toolkits - groups of tools needed to accomplish specific objectives.\nThere are generally around 3-5 tools in a toolkit."),(0,a.kt)("p",null,"LangChain provides a wide set of toolkits to get started.\nFor a full list of toolkits, see ",(0,a.kt)("a",{parentName:"p",href:"/docs/modules/agents/toolkits/"},"here")),(0,a.kt)("h2",{id:"agentexecutor"},"AgentExecutor"),(0,a.kt)("p",null,"The agent executor is the runtime for an agent.\nThis is what actually calls the agent and executes the actions it chooses.\nPseudocode for this runtime is below:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-python"},"next_action = agent.get_action(...)\nwhile next_action != AgentFinish:\n    observation = run(next_action)\n    next_action = agent.get_action(..., next_action, observation)\nreturn next_action\n")),(0,a.kt)("p",null,"While this may seem simple, there are several complexities this runtime handles for you, including:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Handling cases where the agent selects a non-existent tool"),(0,a.kt)("li",{parentName:"ol"},"Handling cases where the tool errors"),(0,a.kt)("li",{parentName:"ol"},"Handling cases where the agent produces output that cannot be parsed into a tool invocation"),(0,a.kt)("li",{parentName:"ol"},"Logging and observability at all levels (agent decisions, tool calls) either to stdout or ",(0,a.kt)("a",{parentName:"li",href:"https://smith.langchain.com"},"LangSmith"),".")),(0,a.kt)("h2",{id:"other-types-of-agent-runtimes"},"Other types of agent runtimes"),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"AgentExecutor")," class is the main agent runtime supported by LangChain.\nHowever, there are other, more experimental runtimes we also support.\nThese include:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"/docs/modules/agents/agent_types/plan_and_execute.html"},"Plan-and-execute Agent")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"/docs/use_cases/autonomous_agents/baby_agi.html"},"Baby AGI")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"/docs/use_cases/autonomous_agents/autogpt.html"},"Auto GPT"))),(0,a.kt)("h2",{id:"get-started"},"Get started"),(0,a.kt)(p,{mdxType:"GetStarted"}))}f.isMDXComponent=!0}}]);