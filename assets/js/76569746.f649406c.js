"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[82068],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>m});var o=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=o.createContext({}),d=function(e){var t=o.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},c=function(e){var t=d(e.components);return o.createElement(l.Provider,{value:t},e.children)},u="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},p=o.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,l=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),u=d(n),p=a,m=u["".concat(l,".").concat(p)]||u[p]||h[p]||r;return n?o.createElement(m,s(s({ref:t},c),{},{components:n})):o.createElement(m,s({ref:t},c))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,s=new Array(r);s[0]=p;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i[u]="string"==typeof e?e:a,s[1]=i;for(var d=2;d<r;d++)s[d]=n[d];return o.createElement.apply(null,s)}return o.createElement.apply(null,n)}p.displayName="MDXCreateElement"},96955:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>m,frontMatter:()=>r,metadata:()=>i,toc:()=>d});var o=n(87462),a=(n(67294),n(3905));const r={},s="Zep",i={unversionedId:"integrations/vectorstores/zep",id:"integrations/vectorstores/zep",title:"Zep",description:"Zep is an open source long-term memory store for LLM applications. Zep makes it easy to add relevant documents,",source:"@site/docs/integrations/vectorstores/zep.md",sourceDirName:"integrations/vectorstores",slug:"/integrations/vectorstores/zep",permalink:"/langchain/docs/integrations/vectorstores/zep",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"integrations",previous:{title:"Xata",permalink:"/langchain/docs/integrations/vectorstores/xata"},next:{title:"Zilliz",permalink:"/langchain/docs/integrations/vectorstores/zilliz"}},l={},d=[{value:"Why Zep&#39;s VectorStore? \ud83e\udd16\ud83d\ude80",id:"why-zeps-vectorstore-",level:2},{value:"Installation",id:"installation",level:2},{value:"Usage",id:"usage",level:2},{value:"Note",id:"note",level:2},{value:"Load or create a Collection from documents",id:"load-or-create-a-collection-from-documents",level:2},{value:"Simarility Search Query over the Collection",id:"simarility-search-query-over-the-collection",level:2},{value:"Search over Collection Re-ranked by MMR",id:"search-over-collection-re-ranked-by-mmr",level:2},{value:"We see results from both books. Note the <code>source</code> metadata",id:"we-see-results-from-both-books-note-the-source-metadata",level:3},{value:"Let&#39;s try again using a filter for only the Sherlock Holmes document.",id:"lets-try-again-using-a-filter-for-only-the-sherlock-holmes-document",level:3}],c=(u="CodeOutputBlock",function(e){return console.warn("Component "+u+" was not imported, exported, or provided by MDXProvider as global scope"),(0,a.kt)("div",e)});var u;const h={toc:d},p="wrapper";function m(e){let{components:t,...n}=e;return(0,a.kt)(p,(0,o.Z)({},h,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"zep"},"Zep"),(0,a.kt)("p",null,"Zep is an open source long-term memory store for LLM applications. Zep makes it easy to add relevant documents,\nchat history memory & rich user data to your LLM app's prompts."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Note:")," The ",(0,a.kt)("inlineCode",{parentName:"p"},"ZepVectorStore")," works with ",(0,a.kt)("inlineCode",{parentName:"p"},"Documents")," and is intended to be used as a ",(0,a.kt)("inlineCode",{parentName:"p"},"Retriever"),".\nIt offers separate functionality to Zep's ",(0,a.kt)("inlineCode",{parentName:"p"},"ZepMemory")," class, which is designed for persisting, enriching\nand searching your user's chat history."),(0,a.kt)("h2",{id:"why-zeps-vectorstore-"},"Why Zep's VectorStore? \ud83e\udd16\ud83d\ude80"),(0,a.kt)("p",null,"Zep automatically embeds documents added to the Zep Vector Store using low-latency models local to the Zep server.\nThe Zep client also offers async interfaces for all document operations. These two together with Zep's chat memory\nfunctionality make Zep ideal for building conversational LLM apps where latency and performance are important."),(0,a.kt)("h2",{id:"installation"},"Installation"),(0,a.kt)("p",null,"Follow the ",(0,a.kt)("a",{parentName:"p",href:"https://docs.getzep.com/deployment/quickstart/"},"Zep Quickstart Guide")," to install and get started with Zep."),(0,a.kt)("h2",{id:"usage"},"Usage"),(0,a.kt)("p",null,"You'll need your Zep API URL and optionally an API key to use the Zep VectorStore.\nSee the ",(0,a.kt)("a",{parentName:"p",href:"https://docs.getzep.com"},"Zep docs")," for more information."),(0,a.kt)("p",null,"In the examples below, we're using Zep's auto-embedding feature which automatically embed documents on the Zep server\nusing low-latency embedding models."),(0,a.kt)("h2",{id:"note"},"Note"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"These examples use Zep's async interfaces. Call sync interfaces by removing the ",(0,a.kt)("inlineCode",{parentName:"li"},"a")," prefix from the method names."),(0,a.kt)("li",{parentName:"ul"},"If you pass in an ",(0,a.kt)("inlineCode",{parentName:"li"},"Embeddings")," instance Zep will use this to embed documents rather than auto-embed them.\nYou must also set your document collection to ",(0,a.kt)("inlineCode",{parentName:"li"},"isAutoEmbedded === false"),". "),(0,a.kt)("li",{parentName:"ul"},"If you set your collection to ",(0,a.kt)("inlineCode",{parentName:"li"},"isAutoEmbedded === false"),", you must pass in an ",(0,a.kt)("inlineCode",{parentName:"li"},"Embeddings")," instance.")),(0,a.kt)("h2",{id:"load-or-create-a-collection-from-documents"},"Load or create a Collection from documents"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-python"},'\x3c!--IMPORTS:[{"imported": "WebBaseLoader", "source": "langchain.document_loaders", "docs": "https://api.python.langchain.com/en/latest/document_loaders/langchain.document_loaders.web_base.WebBaseLoader.html", "title": "Zep"}, {"imported": "RecursiveCharacterTextSplitter", "source": "langchain.text_splitter", "docs": "https://api.python.langchain.com/en/latest/text_splitter/langchain.text_splitter.RecursiveCharacterTextSplitter.html", "title": "Zep"}, {"imported": "ZepVectorStore", "source": "langchain.vectorstores", "docs": "https://api.python.langchain.com/en/latest/vectorstores/langchain.vectorstores.zep.ZepVectorStore.html", "title": "Zep"}, {"imported": "CollectionConfig", "source": "langchain.vectorstores.zep", "docs": "https://api.python.langchain.com/en/latest/vectorstores/langchain.vectorstores.zep.CollectionConfig.html", "title": "Zep"}]--\x3e\nfrom uuid import uuid4\n\nfrom langchain.document_loaders import WebBaseLoader\nfrom langchain.text_splitter import RecursiveCharacterTextSplitter\nfrom langchain.vectorstores import ZepVectorStore\nfrom langchain.vectorstores.zep import CollectionConfig\n\nZEP_API_URL = "http://localhost:8000"  # this is the API url of your Zep instance\nZEP_API_KEY = "<optional_key>"  # optional API Key for your Zep instance\ncollection_name = f"babbage{uuid4().hex}"  # a unique collection name. alphanum only\n\n# Collection config is needed if we\'re creating a new Zep Collection\nconfig = CollectionConfig(\n    name=collection_name,\n    description="<optional description>",\n    metadata={"optional_metadata": "associated with the collection"},\n    is_auto_embedded=True,  # we\'ll have Zep embed our documents using its low-latency embedder\n    embedding_dimensions=1536  # this should match the model you\'ve configured Zep to use.\n)\n\n# load the document\narticle_url = "https://www.gutenberg.org/cache/epub/71292/pg71292.txt"\nloader = WebBaseLoader(article_url)\ndocuments = loader.load()\n\n# split it into chunks\ntext_splitter = RecursiveCharacterTextSplitter(chunk_size=500, chunk_overlap=0)\ndocs = text_splitter.split_documents(documents)\n\n# Instantiate the VectorStore. Since the collection does not already exist in Zep,\n# it will be created and populated with the documents we pass in.\nvs = ZepVectorStore.from_documents(docs,\n                                   collection_name=collection_name,\n                                   config=config,\n                                   api_url=ZEP_API_URL,\n                                   api_key=ZEP_API_KEY\n                                   )\n')),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-python"},'# wait for the collection embedding to complete\n\nasync def wait_for_ready(collection_name: str) -> None:\n    from zep_python import ZepClient\n    import time\n\n    client = ZepClient(ZEP_API_URL, ZEP_API_KEY)\n\n    while True:\n        c = await client.document.aget_collection(collection_name)\n        print(\n            "Embedding status: "\n            f"{c.document_embedded_count}/{c.document_count} documents embedded"\n        )\n        time.sleep(1)\n        if c.status == "ready":\n            break\n\n\nawait wait_for_ready(collection_name)\n')),(0,a.kt)(c,{lang:"python",mdxType:"CodeOutputBlock"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"    Embedding status: 0/402 documents embedded\n    Embedding status: 0/402 documents embedded\n    Embedding status: 402/402 documents embedded\n"))),(0,a.kt)("h2",{id:"simarility-search-query-over-the-collection"},"Simarility Search Query over the Collection"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-python"},'# query it\nquery = "what is the structure of our solar system?"\ndocs_scores = await vs.asimilarity_search_with_relevance_scores(query, k=3)\n\n# print results\nfor d, s in docs_scores:\n    print(d.page_content, " -> ", s, "\\n====\\n")\n')),(0,a.kt)(c,{lang:"python",mdxType:"CodeOutputBlock"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"    Tables necessary to determine the places of the planets are not less\n    necessary than those for the sun, moon, and stars. Some notion of the\n    number and complexity of these tables may be formed, when we state that\n    the positions of the two principal planets, (and these are the most\n    necessary for the navigator,) Jupiter and Saturn, require each not less\n    than one hundred and sixteen tables. Yet it is not only necessary to\n    predict the position of these bodies, but it is likewise expedient to  ->  0.8998482592744614 \n    ====\n    \n    tabulate the motions of the four satellites of Jupiter, to predict the\n    exact times at which they enter his shadow, and at which their shadows\n    cross his disc, as well as the times at which they are interposed\n    between him and the Earth, and he between them and the Earth.\n    \n    Among the extensive classes of tables here enumerated, there are several\n    which are in their nature permanent and unalterable, and would never\n    require to be recomputed, if they could once be computed with perfect  ->  0.8976143854195493 \n    ====\n    \n    the scheme of notation thus applied, immediately suggested the\n    advantages which must attend it as an instrument for expressing the\n    structure, operation, and circulation of the animal system; and we\n    entertain no doubt of its adequacy for that purpose. Not only the\n    mechanical connexion of the solid members of the bodies of men and\n    animals, but likewise the structure and operation of the softer parts,\n    including the muscles, integuments, membranes, &c. the nature, motion,  ->  0.889982614061763 \n    ====\n"))),(0,a.kt)("h2",{id:"search-over-collection-re-ranked-by-mmr"},"Search over Collection Re-ranked by MMR"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-python"},'query = "what is the structure of our solar system?"\ndocs = await vs.asearch(query, search_type="mmr", k=3)\n\nfor d in docs:\n    print(d.page_content, "\\n====\\n")\n')),(0,a.kt)(c,{lang:"python",mdxType:"CodeOutputBlock"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"    Tables necessary to determine the places of the planets are not less\n    necessary than those for the sun, moon, and stars. Some notion of the\n    number and complexity of these tables may be formed, when we state that\n    the positions of the two principal planets, (and these the most\n    necessary for the navigator,) Jupiter and Saturn, require each not less\n    than one hundred and sixteen tables. Yet it is not only necessary to\n    predict the position of these bodies, but it is likewise expedient to \n    ====\n    \n    the scheme of notation thus applied, immediately suggested the\n    advantages which must attend it as an instrument for expressing the\n    structure, operation, and circulation of the animal system; and we\n    entertain no doubt of its adequacy for that purpose. Not only the\n    mechanical connexion of the solid members of the bodies of men and\n    animals, but likewise the structure and operation of the softer parts,\n    including the muscles, integuments, membranes, &c. the nature, motion, \n    ====\n    \n    tabulate the motions of the four satellites of Jupiter, to predict the\n    exact times at which they enter his shadow, and at which their shadows\n    cross his disc, as well as the times at which they are interposed\n    between him and the Earth, and he between them and the Earth.\n    \n    Among the extensive classes of tables here enumerated, there are several\n    which are in their nature permanent and unalterable, and would never\n    require to be recomputed, if they could once be computed with perfect \n    ====\n"))),(0,a.kt)("h1",{id:"filter-by-metadata"},"Filter by Metadata"),(0,a.kt)("p",null,'Use a metadata filter to narrow down results. First, load another book: "Adventures of Sherlock Holmes"'),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-python"},'# Let\'s add more content to the existing Collection\narticle_url = "https://www.gutenberg.org/files/48320/48320-0.txt"\nloader = WebBaseLoader(article_url)\ndocuments = loader.load()\n\n# split it into chunks\ntext_splitter = RecursiveCharacterTextSplitter(chunk_size=500, chunk_overlap=0)\ndocs = text_splitter.split_documents(documents)\n\nawait vs.aadd_documents(docs)\n\nawait wait_for_ready(collection_name)\n')),(0,a.kt)(c,{lang:"python",mdxType:"CodeOutputBlock"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"    Embedding status: 402/1692 documents embedded\n    Embedding status: 402/1692 documents embedded\n    Embedding status: 552/1692 documents embedded\n    Embedding status: 702/1692 documents embedded\n    Embedding status: 1002/1692 documents embedded\n    Embedding status: 1002/1692 documents embedded\n    Embedding status: 1152/1692 documents embedded\n    Embedding status: 1302/1692 documents embedded\n    Embedding status: 1452/1692 documents embedded\n    Embedding status: 1602/1692 documents embedded\n    Embedding status: 1692/1692 documents embedded\n"))),(0,a.kt)("h3",{id:"we-see-results-from-both-books-note-the-source-metadata"},"We see results from both books. Note the ",(0,a.kt)("inlineCode",{parentName:"h3"},"source")," metadata"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-python"},'query = "Was he interested in astronomy?"\ndocs = await vs.asearch(query, search_type="similarity", k=3)\n\nfor d in docs:\n    print(d.page_content, " -> ", d.metadata, "\\n====\\n")\n')),(0,a.kt)(c,{lang:"python",mdxType:"CodeOutputBlock"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"    by that body to Mr Babbage:--'In no department of science, or of the\n    arts, does this discovery promise to be so eminently useful as in that\n    of astronomy, and its kindred sciences, with the various arts dependent\n    on them. In none are computations more operose than those which\n    astronomy in particular requires;--in none are preparatory facilities\n    more needful;--in none is error more detrimental. The practical\n    astronomer is interrupted in his pursuit, and diverted from his task of  ->  {'source': 'https://www.gutenberg.org/cache/epub/71292/pg71292.txt'} \n    ====\n    \n    possess all knowledge which is likely to be useful to him in his work,\n    and this I have endeavored in my case to do. If I remember rightly, you\n    on one occasion, in the early days of our friendship, defined my limits\n    in a very precise fashion.\u201d\n    \n    \u201cYes,\u201d I answered, laughing. \u201cIt was a singular document. Philosophy,\n    astronomy, and politics were marked at zero, I remember. Botany\n    variable, geology profound as regards the mud-stains from any region  ->  {'source': 'https://www.gutenberg.org/files/48320/48320-0.txt'} \n    ====\n    \n    in all its relations; but above all, with Astronomy and Navigation. So\n    important have they been considered, that in many instances large sums\n    have been appropriated by the most enlightened nations in the production\n    of them; and yet so numerous and insurmountable have been the\n    difficulties attending the attainment of this end, that after all, even\n    navigators, putting aside every other department of art and science,\n    have, until very recently, been scantily and imperfectly supplied with  ->  {'source': 'https://www.gutenberg.org/cache/epub/71292/pg71292.txt'} \n    ====\n"))),(0,a.kt)("h3",{id:"lets-try-again-using-a-filter-for-only-the-sherlock-holmes-document"},"Let's try again using a filter for only the Sherlock Holmes document."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-python"},'filter = {\n    "where": {"jsonpath": "$[*] ? (@.source == \'https://www.gutenberg.org/files/48320/48320-0.txt\')"},\n}\n\ndocs = await vs.asearch(query, search_type="similarity", metadata=filter, k=3)\n\nfor d in docs:\n    print(d.page_content, " -> ", d.metadata, "\\n====\\n")\n')),(0,a.kt)(c,{lang:"python",mdxType:"CodeOutputBlock"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"    possess all knowledge which is likely to be useful to him in his work,\n    and this I have endeavored in my case to do. If I remember rightly, you\n    on one occasion, in the early days of our friendship, defined my limits\n    in a very precise fashion.\u201d\n    \n    \u201cYes,\u201d I answered, laughing. \u201cIt was a singular document. Philosophy,\n    astronomy, and politics were marked at zero, I remember. Botany\n    variable, geology profound as regards the mud-stains from any region  ->  {'source': 'https://www.gutenberg.org/files/48320/48320-0.txt'} \n    ====\n    \n    the light shining upon his strong-set aquiline features. So he sat as I\n    dropped off to sleep, and so he sat when a sudden ejaculation caused me\n    to wake up, and I found the summer sun shining into the apartment. The\n    pipe was still between his lips, the smoke still curled upward, and the\n    room was full of a dense tobacco haze, but nothing remained of the heap\n    of shag which I had seen upon the previous night.\n    \n    \u201cAwake, Watson?\u201d he asked.\n    \n    \u201cYes.\u201d\n    \n    \u201cGame for a morning drive?\u201d  ->  {'source': 'https://www.gutenberg.org/files/48320/48320-0.txt'} \n    ====\n    \n    \u201cI glanced at the books upon the table, and in spite of my ignorance\n    of German I could see that two of them were treatises on science, the\n    others being volumes of poetry. Then I walked across to the window,\n    hoping that I might catch some glimpse of the country-side, but an oak\n    shutter, heavily barred, was folded across it. It was a wonderfully\n    silent house. There was an old clock ticking loudly somewhere in the\n    passage, but otherwise everything was deadly still. A vague feeling of  ->  {'source': 'https://www.gutenberg.org/files/48320/48320-0.txt'} \n    ====\n"))))}m.isMDXComponent=!0}}]);